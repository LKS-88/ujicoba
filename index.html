<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI KASIR SUPERMARKET</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary: #007bff; /* Warna biru untuk supermarket */
            --primary-light: #cce5ff;
            --secondary: #0056b3;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --white: #ffffff;
            --shadow-sm: 0 0.15rem 0.35rem rgba(0,0,0,0.1);
            --shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
            --rounded-sm: 0.35rem;
            --rounded: 0.75rem;
            --rounded-lg: 1rem;
            --donation: #6f42c1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: #f0f2f5;
            color: #212529;
            line-height: 1.5;
            touch-action: manipulation;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 12px;
        }

        /* Header Styles */
        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            padding: 12px 16px;
            border-radius: var(--rounded);
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-title-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--white);
            padding: 5px;
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: var(--primary);
        }

        .app-title {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .header-info {
            text-align: right;
            font-size: 0.9rem;
        }

        .header-info p {
            margin: 2px 0;
        }

        /* Main Content Layout */
        .app-content {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* Panel Styles */
        .panel {
            background: var(--white);
            border-radius: var(--rounded);
            padding: 16px;
            box-shadow: var(--shadow-sm);
        }

        .panel-title {
            font-size: 1.2rem;
            margin-bottom: 12px;
            color: var(--dark);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Product Grid */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .product-card {
            background: var(--white);
            border-radius: var(--rounded-sm);
            padding: 12px;
            box-shadow: var(--shadow-sm);
            transition: all 0.2s;
            border: 1px solid #eee;
            cursor: pointer;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .product-image {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            overflow: hidden;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-image i {
            font-size: 1.5rem;
            color: var(--gray);
        }

        .product-name {
            font-weight: 500;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        .product-price {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .product-stock {
            font-size: 0.8rem;
            font-weight: 500;
        }
        .product-stock.low { color: var(--warning); }
        .product-stock.out-of-stock { color: var(--danger); }

        .product-category {
            font-size: 0.7rem;
            color: var(--gray);
            background-color: var(--light);
            padding: 2px 6px;
            border-radius: 10px;
            margin-top: 4px;
        }

        /* Search and Filter */
        .search-container {
            position: relative;
            margin-bottom: 16px;
        }

        .search-container i {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 40px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            font-size: 1rem;
        }

        .filter-row {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .filter-chip {
            padding: 8px 12px;
            background: var(--light);
            border-radius: 20px;
            font-size: 0.9rem;
            white-space: nowrap;
            cursor: pointer;
        }

        .filter-chip.active {
            background: var(--primary);
            color: var(--white);
        }

        /* Order Styles */
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .order-item-info {
            flex: 1;
        }

        .order-item-name {
            font-weight: 500;
        }

        .order-item-price {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .whatsapp-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }
        .whatsapp-link:hover {
            text-decoration: underline;
        }

        .order-item-qty {
            display: flex;
            align-items: center;
        }

        .qty-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #ddd;
            background: var(--light);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .qty-input {
            width: 40px;
            text-align: center;
            margin: 0 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 6px;
        }

        .remove-btn {
            color: var(--danger);
            margin-left: 8px;
            cursor: pointer;
        }

        /* Summary Styles */
        .summary-container {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px dashed #ddd;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .total-row {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--primary);
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #ddd;
        }

        /* Button Styles */
        .btn {
            display: inline-block;
            padding: 12px 20px;
            background-color: var(--primary);
            color: var(--white);
            border: none;
            border-radius: var(--rounded-sm);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            text-align: center;
            transition: all 0.2s;
            width: 100%;
        }
        
        .btn:disabled {
            background-color: var(--gray);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn:hover:not(:disabled) {
            background-color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .btn:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .btn .fa-spinner {
            margin-right: 8px;
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-warning {
            background-color: var(--warning);
            color: #000;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-info {
            background-color: var(--info);
        }

        .btn-info:hover {
            background-color: #138496;
        }
        
        .btn-outline-primary {
            background-color: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        .btn-outline-primary:hover {
            background-color: var(--primary);
            color: var(--white);
        }

        .btn-donation {
            background-color: var(--donation);
        }

        .btn-donation:hover {
            background-color: #5a32a3;
        }

        /* Tab Styles */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 16px;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            text-align: center;
            flex: 1;
        }

        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background-color: var(--white);
            border-radius: var(--rounded-lg);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
            animation: fadeIn 0.3s;
        }

        .modal-header {
            padding: 16px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .modal-body {
            padding: 16px;
        }

        .modal-footer {
            padding: 16px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-check {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            font-size: 1rem;
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        /* === [PERBAIKAN] DESAIN LOGIN === */
        #loginModal {
            background: linear-gradient(45deg, #f0f2f5, #e6e9ed);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-container {
            width: 100%;
            max-width: 400px;
            margin: 0;
            background: var(--white);
            border-radius: var(--rounded-lg);
            padding: 32px;
            box-shadow: var(--shadow);
            border-top: 5px solid var(--primary);
            animation: fadeIn 0.4s;
        }

        .login-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .login-logo {
            font-size: 3.5rem;
            color: var(--primary);
            margin-bottom: 12px;
            line-height: 1;
        }

        .login-title {
            font-size: 2rem;
            color: var(--dark);
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .login-header p {
            color: var(--gray);
        }
        /* === AKHIR DARI PERBAIKAN DESAIN LOGIN === */

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 16px;
            background-color: var(--dark);
            color: var(--white);
            border-radius: var(--rounded-sm);
            box-shadow: var(--shadow);
            z-index: 1100;
            display: flex;
            align-items: center;
            transform: translateX(200%);
            transition: transform 0.3s;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background-color: var(--success);
        }

        .toast.error {
            background-color: var(--danger);
        }

        .toast.warning {
            background-color: var(--warning);
            color: #000;
        }

        .toast i {
            margin-right: 8px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 24px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 12px;
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
            margin-top: 16px;
            padding: 16px;
            background-color: var(--light);
            border-radius: var(--rounded);
        }
        
        .admin-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
        }

        .data-table th, .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background-color: var(--light);
            font-weight: 600;
        }

        .data-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .data-table-container {
            max-height: 40vh;
            overflow-y: auto;
        }
        
        .data-table .text-danger { color: var(--danger) !important; font-weight: 500; }
        .data-table .text-success { color: var(--success) !important; font-weight: 500; }

        /* product Actions */
        .product-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            display: none;
            gap: 4px;
        }

        .product-card:hover .product-actions {
            display: flex;
        }

        .action-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.7rem;
            color: white;
        }

        .edit-btn {
            background-color: var(--info);
        }

        .delete-btn {
            background-color: var(--danger);
        }

        /* Note Input */
        .note-input {
            margin-top: 12px;
        }

        .note-input textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            resize: vertical;
            min-height: 60px;
        }

        /* Member Search */
        .member-search-container {
            position: relative;
        }

        .member-search-results {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border: 1px solid #ddd;
            border-radius: 0 0 var(--rounded-sm) var(--rounded-sm);
            z-index: 100;
            display: none;
        }

        .member-search-item {
            padding: 8px 12px;
            cursor: pointer;
        }

        .member-search-item:hover {
            background-color: var(--light);
        }
        
        /* Payment Modal Enhancements */
        .payment-total-display {
            background: var(--primary-light);
            border-radius: var(--rounded);
            padding: 16px;
            text-align: center;
            margin-bottom: 16px;
        }
        
        .payment-total-display p {
            font-size: 1rem;
            color: var(--secondary);
            margin: 0;
        }
        
        .payment-total-display h3 {
            font-size: 2rem;
            color: var(--primary);
            margin: 0;
        }
        
        .quick-cash-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 16px 0;
        }

        /* Member Badge */
        .member-badge {
            background-color: var(--info);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 6px;
        }

        /* Donation Badge */
        .donation-badge {
            background-color: var(--donation);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 6px;
        }

        /* Responsive Adjustments */
        @media (min-width: 768px) {
            .app-content {
                flex-direction: row;
            }
            
            .product-panel {
                flex: 2;
            }
            
            .order-panel {
                flex: 1;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-content {
            animation: fadeIn 0.3s;
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .mt-2 {
            margin-top: 8px;
        }

        .mt-3 {
            margin-top: 16px;
        }

        .mb-2 {
            margin-bottom: 8px;
        }

        .mb-3 {
            margin-bottom: 16px;
        }

        .d-flex {
            display: flex;
        }

        .justify-between {
            justify-content: space-between;
        }

        .align-center {
            align-items: center;
        }

        .gap-2 {
            gap: 8px;
        }
        
        /* Footer */
        .app-footer {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            color: var(--gray);
            font-size: 0.8rem;
        }
        
        /* === [PENYEMPURNAAN] KODE CETAK STRUK & HISTORI === */
        #receiptContent {
            font-family: 'Courier New', Courier, monospace;
            width: 300px;
            margin: 0 auto;
            padding: 15px;
            font-size: 12px;
            line-height: 1.3;
            color: #000;
            background: white;
        }

        .receipt-header {
            text-align: center;
            margin-bottom: 8px;
        }
        
        .receipt-title {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 3px;
        }

        .receipt-info {
            margin-bottom: 8px;
            font-size: 11px;
            border-top: 1px dashed #000;
            border-bottom: 1px dashed #000;
            padding: 5px 0;
        }
        
        .receipt-info div {
            display: flex;
            justify-content: space-between;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2px;
        }
        
        .receipt-item-details {
            display: block;
        }
        
        .receipt-item-details .item-name {
            font-weight: bold;
        }
        .receipt-item-details .item-price-calc {
            font-size: 10px;
            padding-left: 5px;
        }
        
        #receiptItemsContainer {
             padding: 8px 0;
        }

        .receipt-total {
            font-weight: bold;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #000;
        }

        .receipt-footer {
            margin-top: 12px;
            font-size: 10px;
            text-align: center;
        }
        
        @media print {
            html, body {
                width: 100%; height: auto; margin: 0 !important; padding: 0 !important;
                overflow: visible !important; box-shadow: none;
            }
            body * { visibility: hidden; }
            #print-container, #print-container * {
                visibility: visible; box-sizing: border-box !important;
            }
            #print-container {
                position: absolute; left: 0; top: 0; width: 100%; height: auto;
                margin: 0; padding: 0; display: block !important;
            }
            #print-container .printable-area, #print-container #receiptContent {
                margin: 0 !important; padding: 5px !important; box-shadow: none !important;
                border: none !important; display: block !important; color: #000 !important;
                background: #fff !important; width: 100% !important; 
                font-size: 11pt !important; page-break-inside: avoid;
            }
            #print-container #receiptContent { font-size: 10pt !important; }
            #print-container #historyResultsContainer, #print-container #historyResults {
                max-height: none !important; overflow: visible !important; height: auto !important;
            }
            .no-print, .modal-footer, .modal-header, .app-header, .app-footer, .order-panel, .product-panel, #loginModal {
                display: none !important;
            }
            @page { size: auto; margin: 10mm; }
        }
        /* === AKHIR DARI PENYEMPURNAAN KODE CETAK === */

        /* Backup Restore Styles */
        .backup-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .backup-btn {
            flex: 1;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: block;
            padding: 12px;
            background-color: var(--info);
            color: white;
            border-radius: var(--rounded-sm);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .file-label:hover {
            background-color: #138496;
        }
        
        /* KTA Card Design */
        #ktaCard {
            width: 320px;
            height: 500px;
            margin: 0 auto;
            border-radius: 20px;
            background: radial-gradient(circle at top left, #4f5bd5, #007bff, #17a2b8);
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #ktaCard::before, #ktaCard::after {
            content: ''; position: absolute; background: rgba(255,255,255,0.1);
            border-radius: 50%; filter: blur(10px);
        }
        #ktaCard::before { top: -80px; left: -80px; width: 200px; height: 200px; }
        #ktaCard::after { bottom: -100px; right: -60px; width: 250px; height: 250px; }
        
        .kta-header {
            text-align: center; border-bottom: 1px solid rgba(255,255,255,0.3);
            padding-bottom: 15px; margin-bottom: 25px; z-index: 1;
        }
        .kta-store-info h3 { font-size: 18px; margin: 0; font-weight: 700; text-shadow: 1px 1px 3px rgba(0,0,0,0.3); }
        .kta-store-info p { font-size: 11px; margin: 0; opacity: 0.9; }
        .kta-body {
            flex-grow: 1; display: flex; flex-direction: column; justify-content: center;
            align-items: center; text-align: center; z-index: 1;
        }
        #ktaMemberName { font-size: 26px; font-weight: 600; margin-bottom: 8px; text-shadow: 1px 1px 3px rgba(0,0,0,0.4); }
        #ktaMemberId {
            font-family: 'Courier New', monospace; font-size: 14px; background-color: rgba(0,0,0,0.3);
            padding: 4px 12px; border-radius: 20px; display: inline-block; margin-bottom: 20px; letter-spacing: 1px;
        }
        .kta-qrcode {
            background: white; padding: 10px; border-radius: 8px; min-height: 160px;
            display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .kta-qrcode img { width: 160px; height: auto; display: block; }
        .kta-footer {
            text-align: center; font-size: 11px; opacity: 0.8; padding-top: 15px;
            margin-top: 25px; border-top: 1px solid rgba(255,255,255,0.3); z-index: 1;
        }

        /* [BARU] Role Management Styles */
        .permission-group {
            margin-bottom: 16px;
        }
        .permission-group-title {
            font-weight: 600;
            margin-bottom: 8px;
            border-bottom: 1px solid #eee;
            padding-bottom: 4px;
        }
        .permission-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .permission-item input {
            margin-right: 10px;
        }

        /* [BARU] Shift Management Styles */
        .shift-info {
            background: var(--primary-light);
            border-radius: var(--rounded);
            padding: 12px;
            margin-bottom: 16px;
            text-align: center;
        }
        .shift-info p {
            margin: 4px 0;
            font-weight: 500;
        }
        .shift-active {
            background: var(--success);
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 8px;
        }
        .shift-inactive {
            background: var(--danger);
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 8px;
        }

        /* [BARU] Comprehensive Reports Styles */
        .comprehensive-report-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }
        .report-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }
        .report-type-card {
            background: var(--light);
            border-radius: var(--rounded-sm);
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #ddd;
        }
        .report-type-card:hover {
            background: var(--primary-light);
            border-color: var(--primary);
        }
        .report-type-card.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        .report-type-card i {
            font-size: 2rem;
            margin-bottom: 8px;
        }
        .report-preview {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            padding: 16px;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <div id="toast" class="toast">
        <i class="fas fa-info-circle"></i>
        <span id="toast-message">Notification message</span>
    </div>

    <div id="loginModal" class="modal" style="display: flex;">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <h1 class="login-title">SUPERMARKET</h1>
                <p>Aplikasi Kasir Digital</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" id="username" class="form-control" placeholder="Masukkan username" required>
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Masukkan password" required>
                </div>
                
                <div class="form-group mt-3">
                    <label for="captcha" class="form-label">Verifikasi Keamanan</label>
                    <div class="d-flex align-center gap-2">
                        <canvas id="captchaCanvas" width="150" height="40" style="border: 1px solid #ddd; border-radius: var(--rounded-sm);"></canvas>
                        <button type="button" id="reloadCaptchaBtn" class="btn btn-sm" style="width: auto; background-color: var(--gray);"><i class="fas fa-sync-alt"></i></button>
                    </div>
                    <input type="text" id="captchaInput" class="form-control mt-2" placeholder="Masukkan kode di atas" required autocomplete="off">
                </div>
                <button type="submit" class="btn mt-3">Login</button>
            </form>
        </div>
    </div>

    <div class="container" id="mainApp" style="display: none;">
        <header class="app-header">
            <div class="header-title-container">
                <div class="header-logo">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div>
                    <h1 class="app-title" id="storeNameHeader">SUPERMARKET</h1>
                    <p id="currentDate">Rabu, 24 September 2025</p>
                </div>
            </div>
            <div class="header-info">
                <p>Kasir: <span id="loggedInUser">Admin</span></p>
                <p id="shiftInfo">Shift: <span id="currentShiftStatus">Tidak Aktif</span></p>
                <p><a href="#" id="logoutBtn" style="color: white;">Logout</a></p>
            </div>
        </header>

        <main class="app-content">
            <section class="panel product-panel">
                <h2 class="panel-title">
                    <span>Daftar Produk</span>
                    <span id="productCount">(0 produk)</span>
                </h2>
                
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="productSearch" class="search-input" placeholder="Cari produk...">
                </div>
                
                <div class="filter-row">
                    <div class="filter-chip active" data-category="all">Semua</div>
                </div>
                
                <div class="product-grid" id="productGrid"></div>

                <div id="adminPanel" class="admin-panel">
                    <h3 class="panel-title">Admin Panel</h3>
                    <div class="admin-grid">
                        <button id="addProductBtn" class="btn btn-sm">Tambah Produk</button>
                        <button id="manageCategoriesBtn" class="btn btn-sm">Kelola Kategori</button>
                        <button id="manageStockBtn" class="btn btn-sm">Manajemen Stok</button>
                        <button id="manageSuppliersBtn" class="btn btn-sm">Manajemen Supplier</button>
                        <button id="manageMembersBtn" class="btn btn-sm">Manajemen Member</button>
                        <button id="manageUsersBtn" class="btn btn-sm">Manajemen User</button>
                        <button id="backupRestoreBtn" class="btn btn-sm">Backup & Restore</button>
                        <button id="comprehensiveReportsBtn" class="btn btn-sm">Laporan Komprehensif</button>
                    </div>
                </div>
            </section>

            <section class="panel order-panel">
                <h2 class="panel-title">Transaksi</h2>
                
                <div class="form-group">
                    <label for="memberSearch" class="form-label">Cari Member (opsional)</label>
                    <div class="member-search-container">
                        <input type="text" id="memberSearch" class="form-control" placeholder="Ketik nama atau ID member">
                        <div class="member-search-results" id="memberSearchResults"></div>
                    </div>
                    <div id="selectedMemberInfo" class="mt-2" style="display: none;">
                        <span id="memberName" class="member-badge"></span>
                    </div>
                </div>
                
                <div class="order-items-container" id="orderItemsContainer">
                    <div class="empty-state">
                        <i class="fas fa-shopping-basket"></i>
                        <p>Belum ada produk yang ditambahkan</p>
                    </div>
                </div>
                
                <div class="summary-container">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">Rp 0</span>
                    </div>
                    <div class="summary-row">
                        <span>Diskon:</span>
                        <span id="discount">Rp 0</span>
                    </div>
                    <div class="summary-row">
                        <span>Pajak (10%):</span>
                        <span id="tax">Rp 0</span>
                    </div>
                    <div class="summary-row total-row">
                        <span>Total:</span>
                        <span id="total">Rp 0</span>
                    </div>
                </div>
                
                <div class="note-input">
                    <textarea id="orderNote" placeholder="Catatan transaksi (opsional)"></textarea>
                </div>
                
                <div class="payment-buttons mt-3">
                    <button id="checkoutBtn" class="btn btn-success" disabled>
                        <i class="fas fa-cash-register"></i> Proses Pembayaran
                    </button>
                    <button id="cancelOrderBtn" class="btn btn-danger mt-2">
                        <i class="fas fa-times"></i> Batalkan Transaksi
                    </button>
                    <button id="donationBtn" class="btn btn-donation mt-2">
                        <i class="fas fa-hand-holding-heart"></i> Donasi
                    </button>
                </div>
            </section>
        </main>
        
        <footer class="app-footer">
            <p>&copy; 2025 Aplikasi Kasir Supermarket. All rights reserved.</p>
        </footer>
    </div>

    <!-- Modal untuk Tambah/Edit Produk -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="productModalTitle">Tambah Produk</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <div class="form-group">
                        <label for="productName" class="form-label">Nama Produk</label>
                        <input type="text" id="productName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="productBarcode" class="form-label">Kode/Barcode</label>
                        <input type="text" id="productBarcode" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="productCategory" class="form-label">Kategori</label>
                        <select id="productCategory" class="form-control" required>
                            <option value="">Pilih Kategori</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productUnit" class="form-label">Satuan</label>
                        <input type="text" id="productUnit" class="form-control" placeholder="Contoh: pcs, kg, liter" required>
                    </div>
                    <div class="form-group">
                        <label for="productPurchasePrice" class="form-label">Harga Beli</label>
                        <input type="number" id="productPurchasePrice" class="form-control" min="0" step="100" required>
                    </div>
                    <div class="form-group">
                        <label for="productSellPrice" class="form-label">Harga Jual</label>
                        <input type="number" id="productSellPrice" class="form-control" min="0" step="100" required>
                    </div>
                    <div class="form-group">
                        <label for="productStock" class="form-label">Stok Awal</label>
                        <input type="number" id="productStock" class="form-control" min="0" step="1" required>
                    </div>
                    <div class="form-group">
                        <label for="productMinStock" class="form-label">Stok Minimum</label>
                        <input type="number" id="productMinStock" class="form-control" min="0" step="1" required>
                    </div>
                    <div class="form-group">
                        <label for="productSupplier" class="form-label">Supplier</label>
                        <select id="productSupplier" class="form-control">
                            <option value="">Pilih Supplier</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productImage" class="form-label">Gambar Produk (URL)</label>
                        <input type="text" id="productImage" class="form-control" placeholder="https://example.com/image.jpg">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary" id="cancelProductBtn">Batal</button>
                <button class="btn" id="saveProductBtn">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Modal untuk Pembayaran -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Pembayaran</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="payment-total-display">
                    <p>Total yang harus dibayar:</p>
                    <h3 id="paymentTotal">Rp 0</h3>
                </div>
                
                <div class="form-group">
                    <label for="paymentMethod" class="form-label">Metode Pembayaran</label>
                    <select id="paymentMethod" class="form-control">
                        <option value="cash">Tunai</option>
                        <option value="transfer">Transfer Bank</option>
                        <option value="debit">Kartu Debit</option>
                        <option value="credit">Kartu Kredit</option>
                        <option value="qris">QRIS</option>
                    </select>
                </div>
                
                <div class="form-group" id="cashPaymentGroup">
                    <label for="cashAmount" class="form-label">Jumlah Uang Diberikan</label>
                    <input type="number" id="cashAmount" class="form-control" min="0" step="100">
                </div>
                
                <div class="form-group" id="changeGroup" style="display: none;">
                    <label class="form-label">Kembalian</label>
                    <div id="changeAmount" style="font-size: 1.2rem; font-weight: 600; color: var(--success);">Rp 0</div>
                </div>
                
                <div class="quick-cash-buttons">
                    <button class="btn btn-sm" data-amount="50000">50K</button>
                    <button class="btn btn-sm" data-amount="100000">100K</button>
                    <button class="btn btn-sm" data-amount="150000">150K</button>
                    <button class="btn btn-sm" data-amount="200000">200K</button>
                    <button class="btn btn-sm" data-amount="250000">250K</button>
                    <button class="btn btn-sm" data-amount="500000">500K</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary" id="cancelPaymentBtn">Batal</button>
                <button class="btn btn-success" id="confirmPaymentBtn">Konfirmasi Pembayaran</button>
            </div>
        </div>
    </div>

    <!-- Modal untuk Donasi -->
    <div id="donationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Donasi</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="donationAmount" class="form-label">Jumlah Donasi</label>
                    <input type="number" id="donationAmount" class="form-control" min="1000" step="1000" value="10000">
                </div>
                <div class="form-group">
                    <label for="donationNote" class="form-label">Keterangan Donasi</label>
                    <input type="text" id="donationNote" class="form-control" placeholder="Misal: Donasi untuk bencana alam">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary" id="cancelDonationBtn">Batal</button>
                <button class="btn btn-donation" id="confirmDonationBtn">Konfirmasi Donasi</button>
            </div>
        </div>
    </div>

    <!-- Modal untuk Manajemen Kategori -->
    <div id="categoriesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Kelola Kategori Produk</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="newCategoryName" class="form-label">Nama Kategori Baru</label>
                    <input type="text" id="newCategoryName" class="form-control" placeholder="Masukkan nama kategori">
                </div>
                <div class="form-group">
                    <label for="newCategoryUnit" class="form-label">Satuan Default untuk Kategori</label>
                    <input type="text" id="newCategoryUnit" class="form-control" placeholder="Contoh: pcs, kg, liter">
                </div>
                <button class="btn btn-sm" id="addCategoryBtn">Tambah Kategori</button>
                
                <div class="data-table-container mt-3">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nama Kategori</th>
                                <th>Satuan Default</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="categoriesTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="closeCategoriesBtn">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Modal untuk Manajemen Stok -->
    <div id="stockModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Manajemen Stok</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <div class="tab active" data-tab="stockOpname">Stok Opname</div>
                    <div class="tab" data-tab="stockHistory">Riwayat Stok</div>
                    <div class="tab" data-tab="addStock">Tambah Stok</div>
                </div>
                
                <div class="tab-content active" id="stockOpnameContent">
                    <div class="form-group">
                        <label for="opnameDate" class="form-label">Tanggal Opname</label>
                        <input type="date" id="opnameDate" class="form-control" value="">
                    </div>
                    <button class="btn btn-sm" id="startOpnameBtn">Mulai Stok Opname</button>
                    
                    <div class="data-table-container mt-3">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Produk</th>
                                    <th>Stok Sistem</th>
                                    <th>Stok Nyata</th>
                                    <th>Selisih</th>
                                </tr>
                            </thead>
                            <tbody id="opnameTableBody">
                            </tbody>
                        </table>
                    </div>
                    <div class="d-flex justify-between mt-3">
                        <button class="btn btn-sm btn-outline-primary" id="printOpnameBtn"><i class="fas fa-print"></i> Cetak</button>
                        <button class="btn btn-sm btn-outline-primary" id="downloadOpnamePdfBtn"><i class="fas fa-download"></i> Unduh PDF</button>
                    </div>
                </div>
                
                <div class="tab-content" id="stockHistoryContent">
                    <div class="form-group">
                        <label for="historyDateRange" class="form-label">Filter Tanggal</label>
                        <input type="date" id="historyDateRange" class="form-control">
                    </div>
                    
                    <div class="data-table-container mt-3">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Produk</th>
                                    <th>Jenis</th>
                                    <th>Qty</th>
                                    <th>Keterangan</th>
                                </tr>
                            </thead>
                            <tbody id="stockHistoryTableBody">
                            </tbody>
                        </table>
                    </div>
                    <div class="d-flex justify-between mt-3">
                        <button class="btn btn-sm btn-outline-primary" id="printHistoryBtn"><i class="fas fa-print"></i> Cetak</button>
                        <button class="btn btn-sm btn-outline-primary" id="downloadHistoryPdfBtn"><i class="fas fa-download"></i> Unduh PDF</button>
                    </div>
                </div>
                
                <div class="tab-content" id="addStockContent">
                    <div class="form-group">
                        <label for="stockProduct" class="form-label">Pilih Produk</label>
                        <select id="stockProduct" class="form-control">
                            <option value="">Pilih Produk</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="stockQuantity" class="form-label">Jumlah</label>
                        <input type="number" id="stockQuantity" class="form-control" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label for="stockNote" class="form-label">Keterangan</label>
                        <input type="text" id="stockNote" class="form-control" placeholder="Misal: Pembelian dari supplier">
                    </div>
                    <button class="btn btn-sm" id="addStockBtn">Tambah Stok</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="closeStockBtn">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Modal untuk Manajemen Supplier -->
    <div id="suppliersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Manajemen Supplier</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="supplierName" class="form-label">Nama Supplier</label>
                    <input type="text" id="supplierName" class="form-control" placeholder="Masukkan nama supplier">
                </div>
                <div class="form-group">
                    <label for="supplierContact" class="form-label">Kontak</label>
                    <input type="text" id="supplierContact" class="form-control" placeholder="Nomor telepon atau email">
                </div>
                <div class="form-group">
                    <label for="supplierAddress" class="form-label">Alamat</label>
                    <textarea id="supplierAddress" class="form-control" placeholder="Alamat supplier"></textarea>
                </div>
                <button class="btn btn-sm" id="addSupplierBtn">Tambah Supplier</button>
                
                <div class="data-table-container mt-3">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nama Supplier</th>
                                <th>Kontak</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="suppliersTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="closeSuppliersBtn">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Modal untuk Manajemen Member -->
    <div id="membersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Manajemen Member</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <div class="tab active" data-tab="memberList">Daftar Member</div>
                    <div class="tab" data-tab="addMember">Tambah Member</div>
                    <div class="tab" data-tab="ktaCard">Kartu Member</div>
                </div>
                
                <div class="tab-content active" id="memberListContent">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID Member</th>
                                    <th>Nama</th>
                                    <th>Telepon</th>
                                    <th>Poin</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="membersTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="addMemberContent">
                    <div class="form-group">
                        <label for="memberName" class="form-label">Nama Lengkap</label>
                        <input type="text" id="memberName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="memberPhone" class="form-label">Nomor Telepon</label>
                        <input type="tel" id="memberPhone" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="memberEmail" class="form-label">Email</label>
                        <input type="email" id="memberEmail" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="memberAddress" class="form-label">Alamat</label>
                        <textarea id="memberAddress" class="form-control"></textarea>
                    </div>
                    <button class="btn btn-sm" id="saveMemberBtn">Simpan Member</button>
                </div>
                
                <div class="tab-content" id="ktaCardContent">
                    <div class="form-group">
                        <label for="ktaMemberSelect" class="form-label">Pilih Member</label>
                        <select id="ktaMemberSelect" class="form-control">
                            <option value="">Pilih Member</option>
                        </select>
                    </div>
                    <div id="ktaCard" style="display: none;">
                        <div class="kta-header">
                            <div class="kta-store-info">
                                <h3 id="ktaStoreName">SUPERMARKET</h3>
                                <p>Member Card</p>
                            </div>
                        </div>
                        <div class="kta-body">
                            <div id="ktaMemberName">Nama Member</div>
                            <div id="ktaMemberId">ID: 000000</div>
                            <div class="kta-qrcode">
                                <canvas id="ktaQrCode"></canvas>
                            </div>
                        </div>
                        <div class="kta-footer">
                            <p>Berlaku hingga: <span id="ktaExpiryDate">31/12/2025</span></p>
                        </div>
                    </div>
                    <div class="text-center mt-3">
                        <button class="btn btn-sm" id="printKtaBtn" style="display: none;"><i class="fas fa-print"></i> Cetak Kartu</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="closeMembersBtn">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Modal untuk Manajemen User -->
    <div id="usersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Manajemen User</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <div class="tab active" data-tab="userList">Daftar User</div>
                    <div class="tab" data-tab="addUser">Tambah User</div>
                    <div class="tab" data-tab="shiftManagement">Manajemen Shift</div>
                </div>
                
                <div class="tab-content active" id="userListContent">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Nama Lengkap</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="addUserContent">
                    <div class="form-group">
                        <label for="newUsername" class="form-label">Username</label>
                        <input type="text" id="newUsername" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword" class="form-label">Password</label>
                        <input type="password" id="newPassword" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="newFullName" class="form-label">Nama Lengkap</label>
                        <input type="text" id="newFullName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="newUserRole" class="form-label">Role</label>
                        <select id="newUserRole" class="form-control" required>
                            <option value="kasir">Kasir</option>
                            <option value="admin">Admin</option>
                            <option value="manager">Manager</option>
                        </select>
                    </div>
                    <button class="btn btn-sm" id="saveUserBtn">Simpan User</button>
                </div>
                
                <div class="tab-content" id="shiftManagementContent">
                    <div class="shift-info">
                        <p>Status Shift Saat Ini: <span id="currentShiftStatusDisplay">Tidak Aktif</span></p>
                        <p>Kasir: <span id="currentShiftUser">-</span></p>
                        <p>Saldo Awal: <span id="currentShiftBalance">Rp 0</span></p>
                    </div>
                    
                    <div id="startShiftSection">
                        <div class="form-group">
                            <label for="shiftStartBalance" class="form-label">Saldo Awal Kasir</label>
                            <input type="number" id="shiftStartBalance" class="form-control" min="0" value="0">
                        </div>
                        <button class="btn btn-sm btn-success" id="startShiftBtn">Mulai Shift</button>
                    </div>
                    
                    <div id="endShiftSection" style="display: none;">
                        <div class="form-group">
                            <label for="shiftEndBalance" class="form-label">Saldo Akhir Kasir</label>
                            <input type="number" id="shiftEndBalance" class="form-control" min="0" value="0">
                        </div>
                        <button class="btn btn-sm btn-danger" id="endShiftBtn">Akhiri Shift</button>
                    </div>
                    
                    <div class="data-table-container mt-3">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Kasir</th>
                                    <th>Saldo Awal</th>
                                    <th>Saldo Akhir</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="shiftHistoryTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="closeUsersBtn">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Modal untuk Backup & Restore -->
    <div id="backupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Backup & Restore Data</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <h4>Backup Data</h4>
                    <p>Unduh salinan data aplikasi untuk keamanan.</p>
                    <button class="btn btn-sm btn-success" id="backupDataBtn"><i class="fas fa-download"></i> Backup Data</button>
                </div>
                
                <div class="form-group">
                    <h4>Restore Data</h4>
                    <p>Upload file backup untuk mengembalikan data.</p>
                    <input type="file" id="restoreFile" class="file-input" accept=".json">
                    <label for="restoreFile" class="file-label"><i class="fas fa-upload"></i> Pilih File Backup</label>
                    <button class="btn btn-sm btn-warning mt-2" id="restoreDataBtn" disabled><i class="fas fa-upload"></i> Restore Data</button>
                </div>
                
                <div class="form-group">
                    <h4>Reset Data</h4>
                    <p>Hapus semua data dan reset ke pengaturan awal.</p>
                    <button class="btn btn-sm btn-danger" id="resetDataBtn"><i class="fas fa-trash"></i> Reset Data</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="closeBackupBtn">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Modal untuk Laporan Komprehensif -->
    <div id="comprehensiveReportsModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title">Laporan Komprehensif</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="comprehensive-report-controls">
                    <div class="form-group">
                        <label for="reportStartDate" class="form-label">Tanggal Mulai</label>
                        <input type="date" id="reportStartDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="reportEndDate" class="form-label">Tanggal Akhir</label>
                        <input type="date" id="reportEndDate" class="form-control">
                    </div>
                </div>
                
                <div class="report-type-grid">
                    <div class="report-type-card active" data-report="dailySales">
                        <i class="fas fa-chart-line"></i>
                        <h4>Laporan Harian</h4>
                        <p>Penjualan per shift</p>
                    </div>
                    <div class="report-type-card" data-report="salesProfit">
                        <i class="fas fa-money-bill-wave"></i>
                        <h4>Laporan Penjualan</h4>
                        <p>Laba rugi & transaksi</p>
                    </div>
                    <div class="report-type-card" data-report="returnsStock">
                        <i class="fas fa-undo"></i>
                        <h4>Laporan Retur & Stok</h4>
                        <p>Retur dan penambahan stok</p>
                    </div>
                    <div class="report-type-card" data-report="donations">
                        <i class="fas fa-hand-holding-heart"></i>
                        <h4>Laporan Donasi</h4>
                        <p>Donasi lengkap dengan petugas</p>
                    </div>
                    <div class="report-type-card" data-report="members">
                        <i class="fas fa-users"></i>
                        <h4>Laporan Member</h4>
                        <p>Data member lengkap</p>
                    </div>
                </div>
                
                <div class="report-preview" id="reportPreview">
                    <p class="text-center">Pilih jenis laporan untuk melihat pratinjau</p>
                </div>
                
                <div class="d-flex justify-between mt-3">
                    <button class="btn btn-sm btn-outline-primary" id="printReportBtn"><i class="fas fa-print"></i> Cetak Laporan</button>
                    <button class="btn btn-sm btn-outline-primary" id="downloadReportPdfBtn"><i class="fas fa-download"></i> Unduh PDF</button>
                    <button class="btn btn-sm btn-outline-primary" id="downloadReportExcelBtn"><i class="fas fa-file-excel"></i> Unduh Excel</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="closeReportsBtn">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Modal untuk Histori Transaksi -->
    <div id="historyModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">Histori Transaksi</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="historyDateFilter" class="form-label">Filter Tanggal</label>
                    <input type="date" id="historyDateFilter" class="form-control">
                </div>
                
                <div class="data-table-container" style="max-height: 400px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>ID Transaksi</th>
                                <th>Total</th>
                                <th>Kasir</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary" id="printHistoryReportBtn"><i class="fas fa-print"></i> Cetak</button>
                <button class="btn" id="closeHistoryBtn">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Modal untuk Cetak Struk -->
    <div id="receiptModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Struk Transaksi</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="receiptContent">
                    <div class="receipt-header">
                        <div class="receipt-title" id="receiptStoreName">SUPERMARKET</div>
                        <div id="receiptStoreAddress">Jl. Contoh No. 123, Kota Contoh</div>
                        <div id="receiptStorePhone">Telp: (021) 123-4567</div>
                    </div>
                    
                    <div class="receipt-info">
                        <div>
                            <span>Tanggal:</span>
                            <span id="receiptDate">24/09/2025 14:30</span>
                        </div>
                        <div>
                            <span>Kasir:</span>
                            <span id="receiptCashier">Admin</span>
                        </div>
                        <div>
                            <span>ID Transaksi:</span>
                            <span id="receiptId">TRX-20250924-001</span>
                        </div>
                    </div>
                    
                    <div id="receiptItemsContainer">
                        <!-- Items will be populated here -->
                    </div>
                    
                    <div class="receipt-total">
                        <div class="receipt-item">
                            <span>Total:</span>
                            <span id="receiptTotal">Rp 0</span>
                        </div>
                        <div class="receipt-item">
                            <span>Bayar:</span>
                            <span id="receiptPayment">Rp 0</span>
                        </div>
                        <div class="receipt-item">
                            <span>Kembali:</span>
                            <span id="receiptChange">Rp 0</span>
                        </div>
                    </div>
                    
                    <div class="receipt-footer">
                        <div>Terima kasih atas kunjungan Anda</div>
                        <div>Barang yang sudah dibeli tidak dapat ditukar atau dikembalikan</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-primary" id="printReceiptBtn"><i class="fas fa-print"></i> Cetak Struk</button>
                <button class="btn" id="closeReceiptBtn">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Container untuk cetakan -->
    <div id="print-container" style="display: none;"></div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script>
        // Inisialisasi jsPDF
        const { jsPDF } = window.jspdf;

        // Data aplikasi
        let appData = {
            products: [],
            categories: [
                { id: 1, name: "Makanan", unit: "pcs" },
                { id: 2, name: "Minuman", unit: "botol" },
                { id: 3, name: "Elektronik", unit: "unit" },
                { id: 4, name: "Peralatan Rumah Tangga", unit: "pcs" }
            ],
            suppliers: [
                { id: 1, name: "Supplier A", contact: "08123456789", address: "Jl. Supplier No. 1" },
                { id: 2, name: "Supplier B", contact: "08234567890", address: "Jl. Supplier No. 2" }
            ],
            members: [],
            users: [
                { username: "admin", password: "admin123", fullName: "Administrator", role: "admin" },
                { username: "kasir1", password: "kasir123", fullName: "Kasir Satu", role: "kasir" }
            ],
            transactions: [],
            donations: [],
            stockHistory: [],
            shifts: [],
            currentShift: null,
            settings: {
                storeName: "SUPERMARKET",
                storeAddress: "Jl. Contoh No. 123, Kota Contoh",
                storePhone: "(021) 123-4567",
                taxRate: 10
            }
        };

        // State aplikasi
        let currentUser = null;
        let currentOrder = {
            items: [],
            member: null,
            note: "",
            subtotal: 0,
            discount: 0,
            tax: 0,
            total: 0
        };
        let editingProductId = null;
        let currentReportType = 'dailySales';

        // Inisialisasi aplikasi
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            generateCaptcha();
            updateDateTime();
            setInterval(updateDateTime, 60000); // Update waktu setiap menit
        });

        // Fungsi inisialisasi aplikasi
        function initializeApp() {
            // Load data dari localStorage jika ada
            loadDataFromStorage();
            
            // Update tampilan dengan data yang dimuat
            updateProductGrid();
            updateCategoriesFilter();
            updateProductCategoryOptions();
            updateSupplierOptions();
            updateMemberSelectOptions();
            updateStockProductOptions();
            updateKtaMemberSelect();
            updateUsersTable();
            updateShiftInfo();
            
            // Set tanggal default untuk filter
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('opnameDate').value = today;
            document.getElementById('historyDateRange').value = today;
            document.getElementById('historyDateFilter').value = today;
            document.getElementById('reportStartDate').value = today;
            document.getElementById('reportEndDate').value = today;
        }

        // Fungsi untuk menyimpan data ke localStorage
        function saveDataToStorage() {
            localStorage.setItem('supermarketAppData', JSON.stringify(appData));
            localStorage.setItem('supermarketCurrentUser', JSON.stringify(currentUser));
        }

        // Fungsi untuk memuat data dari localStorage
        function loadDataFromStorage() {
            const savedData = localStorage.getItem('supermarketAppData');
            const savedUser = localStorage.getItem('supermarketCurrentUser');
            
            if (savedData) {
                appData = JSON.parse(savedData);
            }
            
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
            }
        }

        // Fungsi untuk mengatur event listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('reloadCaptchaBtn').addEventListener('click', generateCaptcha);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Pencarian produk
            document.getElementById('productSearch').addEventListener('input', filterProducts);
            
            // Filter kategori
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.addEventListener('click', function() {
                    document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    filterProducts();
                });
            });
            
            // Tombol admin panel
            document.getElementById('addProductBtn').addEventListener('click', showAddProductModal);
            document.getElementById('manageCategoriesBtn').addEventListener('click', showCategoriesModal);
            document.getElementById('manageStockBtn').addEventListener('click', showStockModal);
            document.getElementById('manageSuppliersBtn').addEventListener('click', showSuppliersModal);
            document.getElementById('manageMembersBtn').addEventListener('click', showMembersModal);
            document.getElementById('manageUsersBtn').addEventListener('click', showUsersModal);
            document.getElementById('backupRestoreBtn').addEventListener('click', showBackupModal);
            document.getElementById('comprehensiveReportsBtn').addEventListener('click', showComprehensiveReportsModal);
            
            // Pencarian member
            document.getElementById('memberSearch').addEventListener('input', searchMembers);
            
            // Tombol transaksi
            document.getElementById('checkoutBtn').addEventListener('click', showPaymentModal);
            document.getElementById('cancelOrderBtn').addEventListener('click', cancelOrder);
            document.getElementById('donationBtn').addEventListener('click', showDonationModal);
            
            // Modal produk
            document.getElementById('saveProductBtn').addEventListener('click', saveProduct);
            document.getElementById('cancelProductBtn').addEventListener('click', closeProductModal);
            document.querySelector('#productModal .modal-close').addEventListener('click', closeProductModal);
            
            // Modal pembayaran
            document.getElementById('confirmPaymentBtn').addEventListener('click', confirmPayment);
            document.getElementById('cancelPaymentBtn').addEventListener('click', closePaymentModal);
            document.querySelector('#paymentModal .modal-close').addEventListener('click', closePaymentModal);
            document.getElementById('cashAmount').addEventListener('input', calculateChange);
            document.querySelectorAll('.quick-cash-buttons button').forEach(button => {
                button.addEventListener('click', function() {
                    const amount = parseInt(this.getAttribute('data-amount'));
                    document.getElementById('cashAmount').value = amount;
                    calculateChange();
                });
            });
            
            // Modal donasi
            document.getElementById('confirmDonationBtn').addEventListener('click', confirmDonation);
            document.getElementById('cancelDonationBtn').addEventListener('click', closeDonationModal);
            document.querySelector('#donationModal .modal-close').addEventListener('click', closeDonationModal);
            
            // Modal kategori
            document.getElementById('addCategoryBtn').addEventListener('click', addCategory);
            document.getElementById('closeCategoriesBtn').addEventListener('click', closeCategoriesModal);
            document.querySelector('#categoriesModal .modal-close').addEventListener('click', closeCategoriesModal);
            
            // Modal stok
            document.querySelectorAll('#stockModal .tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchStockTab(tabName);
                });
            });
            document.getElementById('startOpnameBtn').addEventListener('click', startStockOpname);
            document.getElementById('addStockBtn').addEventListener('click', addStock);
            document.getElementById('closeStockBtn').addEventListener('click', closeStockModal);
            document.querySelector('#stockModal .modal-close').addEventListener('click', closeStockModal);
            document.getElementById('printOpnameBtn').addEventListener('click', printOpnameReport);
            document.getElementById('downloadOpnamePdfBtn').addEventListener('click', downloadOpnamePdf);
            document.getElementById('printHistoryBtn').addEventListener('click', printHistoryReport);
            document.getElementById('downloadHistoryPdfBtn').addEventListener('click', downloadHistoryPdf);
            
            // Modal supplier
            document.getElementById('addSupplierBtn').addEventListener('click', addSupplier);
            document.getElementById('closeSuppliersBtn').addEventListener('click', closeSuppliersModal);
            document.querySelector('#suppliersModal .modal-close').addEventListener('click', closeSuppliersModal);
            
            // Modal member
            document.querySelectorAll('#membersModal .tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchMemberTab(tabName);
                });
            });
            document.getElementById('saveMemberBtn').addEventListener('click', saveMember);
            document.getElementById('ktaMemberSelect').addEventListener('change', generateKtaCard);
            document.getElementById('printKtaBtn').addEventListener('click', printKtaCard);
            document.getElementById('closeMembersBtn').addEventListener('click', closeMembersModal);
            document.querySelector('#membersModal .modal-close').addEventListener('click', closeMembersModal);
            
            // Modal user
            document.querySelectorAll('#usersModal .tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchUserTab(tabName);
                });
            });
            document.getElementById('saveUserBtn').addEventListener('click', saveUser);
            document.getElementById('startShiftBtn').addEventListener('click', startShift);
            document.getElementById('endShiftBtn').addEventListener('click', endShift);
            document.getElementById('closeUsersBtn').addEventListener('click', closeUsersModal);
            document.querySelector('#usersModal .modal-close').addEventListener('click', closeUsersModal);
            
            // Modal backup
            document.getElementById('backupDataBtn').addEventListener('click', backupData);
            document.getElementById('restoreFile').addEventListener('change', enableRestoreButton);
            document.getElementById('restoreDataBtn').addEventListener('click', restoreData);
            document.getElementById('resetDataBtn').addEventListener('click', resetData);
            document.getElementById('closeBackupBtn').addEventListener('click', closeBackupModal);
            document.querySelector('#backupModal .modal-close').addEventListener('click', closeBackupModal);
            
            // Modal laporan komprehensif
            document.querySelectorAll('.report-type-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.report-type-card').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    currentReportType = this.getAttribute('data-report');
                    generateReportPreview();
                });
            });
            document.getElementById('printReportBtn').addEventListener('click', printComprehensiveReport);
            document.getElementById('downloadReportPdfBtn').addEventListener('click', downloadComprehensiveReportPdf);
            document.getElementById('downloadReportExcelBtn').addEventListener('click', downloadComprehensiveReportExcel);
            document.getElementById('closeReportsBtn').addEventListener('click', closeComprehensiveReportsModal);
            document.querySelector('#comprehensiveReportsModal .modal-close').addEventListener('click', closeComprehensiveReportsModal);
            document.getElementById('reportStartDate').addEventListener('change', generateReportPreview);
            document.getElementById('reportEndDate').addEventListener('change', generateReportPreview);
            
            // Modal histori transaksi
            document.getElementById('historyDateFilter').addEventListener('change', updateTransactionHistory);
            document.getElementById('printHistoryReportBtn').addEventListener('click', printTransactionHistory);
            document.getElementById('closeHistoryBtn').addEventListener('click', closeHistoryModal);
            document.querySelector('#historyModal .modal-close').addEventListener('click', closeHistoryModal);
            
            // Modal struk
            document.getElementById('printReceiptBtn').addEventListener('click', printReceipt);
            document.getElementById('closeReceiptBtn').addEventListener('click', closeReceiptModal);
            document.querySelector('#receiptModal .modal-close').addEventListener('click', closeReceiptModal);
            
            // Close modal dengan klik di luar konten
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            });
        }

        // Fungsi untuk menghasilkan CAPTCHA
        function generateCaptcha() {
            const canvas = document.getElementById('captchaCanvas');
            const ctx = canvas.getContext('2d');
            
            // Bersihkan canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Warna background
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Generate teks CAPTCHA acak
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let captchaText = '';
            for (let i = 0; i < 5; i++) {
                captchaText += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            // Simpan teks CAPTCHA di sessionStorage
            sessionStorage.setItem('captchaText', captchaText);
            
            // Gambar teks CAPTCHA
            ctx.font = 'bold 24px Arial';
            ctx.fillStyle = '#343a40';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // Tambahkan distorsi pada teks
            for (let i = 0; i < captchaText.length; i++) {
                ctx.save();
                ctx.translate(30 + i * 24, 20);
                ctx.rotate((Math.random() - 0.5) * 0.4);
                ctx.fillText(captchaText[i], 0, 0);
                ctx.restore();
            }
            
            // Tambahkan garis gangguan
            for (let i = 0; i < 5; i++) {
                ctx.beginPath();
                ctx.moveTo(Math.random() * canvas.width, Math.random() * canvas.height);
                ctx.lineTo(Math.random() * canvas.width, Math.random() * canvas.height);
                ctx.strokeStyle = `rgba(0, 0, 0, ${Math.random() * 0.5})`;
                ctx.lineWidth = 1;
                ctx.stroke();
            }
            
            // Tambahkan noise
            for (let i = 0; i < 50; i++) {
                ctx.fillStyle = `rgba(0, 0, 0, ${Math.random() * 0.3})`;
                ctx.fillRect(Math.random() * canvas.width, Math.random() * canvas.height, 1, 1);
            }
        }

        // Fungsi untuk menangani login
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const captchaInput = document.getElementById('captchaInput').value;
            const captchaText = sessionStorage.getItem('captchaText');
            
            // Validasi CAPTCHA
            if (captchaInput.toUpperCase() !== captchaText) {
                showToast('Kode keamanan tidak sesuai!', 'error');
                generateCaptcha();
                document.getElementById('captchaInput').value = '';
                return;
            }
            
            // Cari user
            const user = appData.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                document.getElementById('loggedInUser').textContent = user.fullName;
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                
                // Tampilkan admin panel jika user adalah admin
                if (user.role === 'admin' || user.role === 'manager') {
                    document.getElementById('adminPanel').style.display = 'block';
                }
                
                showToast(`Login berhasil! Selamat datang ${user.fullName}`, 'success');
                saveDataToStorage();
            } else {
                showToast('Username atau password salah!', 'error');
                generateCaptcha();
                document.getElementById('captchaInput').value = '';
            }
        }

        // Fungsi untuk menangani logout
        function handleLogout(e) {
            e.preventDefault();
            
            if (confirm('Apakah Anda yakin ingin logout?')) {
                currentUser = null;
                document.getElementById('loginModal').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('loginForm').reset();
                generateCaptcha();
                showToast('Logout berhasil!', 'success');
            }
        }

        // Fungsi untuk memperbarui tanggal dan waktu
        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('id-ID', options);
        }

        // Fungsi untuk menampilkan notifikasi toast
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toastMessage.textContent = message;
            toast.className = 'toast';
            toast.classList.add(type);
            
            // Tampilkan toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // Sembunyikan toast setelah 3 detik
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Fungsi untuk memperbarui grid produk
        function updateProductGrid(products = appData.products) {
            const productGrid = document.getElementById('productGrid');
            const productCount = document.getElementById('productCount');
            
            productGrid.innerHTML = '';
            productCount.textContent = `(${products.length} produk)`;
            
            if (products.length === 0) {
                productGrid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-box-open"></i>
                        <p>Tidak ada produk ditemukan</p>
                    </div>
                `;
                return;
            }
            
            products.forEach(product => {
                const stockStatus = product.stock === 0 ? 'out-of-stock' : (product.stock <= product.minStock ? 'low' : '');
                
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <div class="product-actions">
                        <div class="action-btn edit-btn" data-id="${product.id}">
                            <i class="fas fa-edit"></i>
                        </div>
                        <div class="action-btn delete-btn" data-id="${product.id}">
                            <i class="fas fa-trash"></i>
                        </div>
                    </div>
                    <div class="product-image">
                        ${product.image ? 
                            `<img src="${product.image}" alt="${product.name}" onerror="this.style.display='none'; this.parentElement.innerHTML='<i class=\\'fas fa-box\\'></i>';" />` : 
                            `<i class="fas fa-box"></i>`
                        }
                    </div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">Rp ${formatNumber(product.sellPrice)}</div>
                    <div class="product-stock ${stockStatus}">Stok: ${product.stock} ${product.unit}</div>
                    <div class="product-category">${getCategoryName(product.categoryId)}</div>
                `;
                
                // Event listener untuk menambahkan produk ke pesanan
                productCard.addEventListener('click', function(e) {
                    if (!e.target.classList.contains('action-btn')) {
                        addProductToOrder(product.id);
                    }
                });
                
                // Event listener untuk edit produk
                productCard.querySelector('.edit-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    editProduct(product.id);
                });
                
                // Event listener untuk hapus produk
                productCard.querySelector('.delete-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    deleteProduct(product.id);
                });
                
                productGrid.appendChild(productCard);
            });
        }

        // Fungsi untuk memfilter produk berdasarkan pencarian dan kategori
        function filterProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const activeCategory = document.querySelector('.filter-chip.active').getAttribute('data-category');
            
            let filteredProducts = appData.products;
            
            // Filter berdasarkan pencarian
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) || 
                    product.barcode.toLowerCase().includes(searchTerm)
                );
            }
            
            // Filter berdasarkan kategori
            if (activeCategory !== 'all') {
                const categoryId = parseInt(activeCategory);
                filteredProducts = filteredProducts.filter(product => product.categoryId === categoryId);
            }
            
            updateProductGrid(filteredProducts);
        }

        // Fungsi untuk memperbarui filter kategori
        function updateCategoriesFilter() {
            const filterRow = document.querySelector('.filter-row');
            
            // Hapus semua filter chip kecuali "Semua"
            const allChip = filterRow.querySelector('.filter-chip[data-category="all"]');
            filterRow.innerHTML = '';
            filterRow.appendChild(allChip);
            
            // Tambahkan filter chip untuk setiap kategori
            appData.categories.forEach(category => {
                const chip = document.createElement('div');
                chip.className = 'filter-chip';
                chip.setAttribute('data-category', category.id);
                chip.textContent = category.name;
                chip.addEventListener('click', function() {
                    document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    filterProducts();
                });
                filterRow.appendChild(chip);
            });
        }

        // Fungsi untuk menambahkan produk ke pesanan
        function addProductToOrder(productId) {
            const product = appData.products.find(p => p.id === productId);
            
            if (!product) {
                showToast('Produk tidak ditemukan!', 'error');
                return;
            }
            
            if (product.stock <= 0) {
                showToast('Stok produk habis!', 'error');
                return;
            }
            
            // Cek apakah produk sudah ada di pesanan
            const existingItem = currentOrder.items.find(item => item.productId === productId);
            
            if (existingItem) {
                if (existingItem.quantity >= product.stock) {
                    showToast('Stok produk tidak mencukupi!', 'error');
                    return;
                }
                existingItem.quantity += 1;
            } else {
                currentOrder.items.push({
                    productId: productId,
                    name: product.name,
                    price: product.sellPrice,
                    quantity: 1,
                    unit: product.unit
                });
            }
            
            // Kurangi stok produk (sementara)
            product.stock -= 1;
            
            updateOrderDisplay();
            showToast(`${product.name} ditambahkan ke pesanan`, 'success');
        }

        // Fungsi untuk memperbarui tampilan pesanan
        function updateOrderDisplay() {
            const orderItemsContainer = document.getElementById('orderItemsContainer');
            const checkoutBtn = document.getElementById('checkoutBtn');
            
            // Hitung subtotal
            currentOrder.subtotal = currentOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Hitung pajak
            currentOrder.tax = currentOrder.subtotal * (appData.settings.taxRate / 100);
            
            // Hitung total
            currentOrder.total = currentOrder.subtotal + currentOrder.tax - currentOrder.discount;
            
            // Update tampilan subtotal, pajak, diskon, dan total
            document.getElementById('subtotal').textContent = `Rp ${formatNumber(currentOrder.subtotal)}`;
            document.getElementById('tax').textContent = `Rp ${formatNumber(currentOrder.tax)}`;
            document.getElementById('discount').textContent = `Rp ${formatNumber(currentOrder.discount)}`;
            document.getElementById('total').textContent = `Rp ${formatNumber(currentOrder.total)}`;
            
            // Update tampilan item pesanan
            if (currentOrder.items.length === 0) {
                orderItemsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-shopping-basket"></i>
                        <p>Belum ada produk yang ditambahkan</p>
                    </div>
                `;
                checkoutBtn.disabled = true;
            } else {
                orderItemsContainer.innerHTML = '';
                
                currentOrder.items.forEach((item, index) => {
                    const product = appData.products.find(p => p.id === item.productId);
                    const itemTotal = item.price * item.quantity;
                    
                    const orderItem = document.createElement('div');
                    orderItem.className = 'order-item';
                    orderItem.innerHTML = `
                        <div class="order-item-info">
                            <div class="order-item-name">${item.name}</div>
                            <div class="order-item-price">Rp ${formatNumber(item.price)}/${item.unit}</div>
                        </div>
                        <div class="order-item-qty">
                            <div class="qty-btn minus-btn" data-index="${index}">-</div>
                            <input type="number" class="qty-input" value="${item.quantity}" min="1" max="${product ? product.stock + item.quantity : item.quantity}" data-index="${index}">
                            <div class="qty-btn plus-btn" data-index="${index}">+</div>
                            <div class="remove-btn" data-index="${index}"><i class="fas fa-trash"></i></div>
                        </div>
                    `;
                    
                    // Event listener untuk tombol minus
                    orderItem.querySelector('.minus-btn').addEventListener('click', function() {
                        updateOrderItemQuantity(index, item.quantity - 1);
                    });
                    
                    // Event listener untuk tombol plus
                    orderItem.querySelector('.plus-btn').addEventListener('click', function() {
                        if (product && item.quantity < product.stock + item.quantity) {
                            updateOrderItemQuantity(index, item.quantity + 1);
                        } else {
                            showToast('Stok produk tidak mencukupi!', 'error');
                        }
                    });
                    
                    // Event listener untuk input quantity
                    orderItem.querySelector('.qty-input').addEventListener('change', function() {
                        const newQty = parseInt(this.value);
                        if (newQty < 1) {
                            this.value = 1;
                            updateOrderItemQuantity(index, 1);
                        } else if (product && newQty > product.stock + item.quantity) {
                            this.value = item.quantity;
                            showToast('Stok produk tidak mencukupi!', 'error');
                        } else {
                            updateOrderItemQuantity(index, newQty);
                        }
                    });
                    
                    // Event listener untuk tombol hapus
                    orderItem.querySelector('.remove-btn').addEventListener('click', function() {
                        removeOrderItem(index);
                    });
                    
                    orderItemsContainer.appendChild(orderItem);
                });
                
                checkoutBtn.disabled = false;
            }
        }

        // Fungsi untuk memperbarui jumlah item pesanan
        function updateOrderItemQuantity(index, newQuantity) {
            if (newQuantity < 1) return;
            
            const item = currentOrder.items[index];
            const product = appData.products.find(p => p.id === item.productId);
            
            if (!product) return;
            
            // Hitung perubahan stok
            const quantityChange = newQuantity - item.quantity;
            
            // Periksa apakah stok mencukupi
            if (quantityChange > 0 && product.stock < quantityChange) {
                showToast('Stok produk tidak mencukupi!', 'error');
                return;
            }
            
            // Update stok produk
            product.stock -= quantityChange;
            
            // Update quantity item
            item.quantity = newQuantity;
            
            updateOrderDisplay();
        }

        // Fungsi untuk menghapus item dari pesanan
        function removeOrderItem(index) {
            const item = currentOrder.items[index];
            const product = appData.products.find(p => p.id === item.productId);
            
            if (product) {
                // Kembalikan stok produk
                product.stock += item.quantity;
            }
            
            // Hapus item dari pesanan
            currentOrder.items.splice(index, 1);
            
            updateOrderDisplay();
            showToast(`${item.name} dihapus dari pesanan`, 'success');
        }

        // Fungsi untuk membatalkan pesanan
        function cancelOrder() {
            if (currentOrder.items.length === 0) {
                showToast('Tidak ada pesanan untuk dibatalkan', 'warning');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin membatalkan transaksi ini? Semua item akan dihapus.')) {
                // Kembalikan stok semua produk
                currentOrder.items.forEach(item => {
                    const product = appData.products.find(p => p.id === item.productId);
                    if (product) {
                        product.stock += item.quantity;
                    }
                });
                
                // Reset pesanan
                currentOrder = {
                    items: [],
                    member: null,
                    note: "",
                    subtotal: 0,
                    discount: 0,
                    tax: 0,
                    total: 0
                };
                
                // Reset pencarian member
                document.getElementById('memberSearch').value = '';
                document.getElementById('selectedMemberInfo').style.display = 'none';
                document.getElementById('orderNote').value = '';
                
                updateOrderDisplay();
                showToast('Pesanan dibatalkan', 'success');
            }
        }

        // Fungsi untuk mencari member
        function searchMembers() {
            const searchTerm = document.getElementById('memberSearch').value.toLowerCase();
            const resultsContainer = document.getElementById('memberSearchResults');
            
            if (searchTerm.length < 2) {
                resultsContainer.style.display = 'none';
                return;
            }
            
            const filteredMembers = appData.members.filter(member => 
                member.name.toLowerCase().includes(searchTerm) || 
                member.id.toString().includes(searchTerm)
            );
            
            resultsContainer.innerHTML = '';
            
            if (filteredMembers.length === 0) {
                resultsContainer.innerHTML = '<div class="member-search-item">Tidak ada member ditemukan</div>';
            } else {
                filteredMembers.forEach(member => {
                    const item = document.createElement('div');
                    item.className = 'member-search-item';
                    item.textContent = `${member.name} (ID: ${member.id})`;
                    item.addEventListener('click', function() {
                        selectMember(member);
                    });
                    resultsContainer.appendChild(item);
                });
            }
            
            resultsContainer.style.display = 'block';
        }

        // Fungsi untuk memilih member
        function selectMember(member) {
            currentOrder.member = member;
            document.getElementById('memberSearch').value = '';
            document.getElementById('memberSearchResults').style.display = 'none';
            
            const memberInfo = document.getElementById('selectedMemberInfo');
            document.getElementById('memberName').textContent = `${member.name} (ID: ${member.id})`;
            memberInfo.style.display = 'block';
            
            showToast(`Member ${member.name} dipilih`, 'success');
        }

        // ========== MODAL FUNCTIONS ==========

        // Modal Produk
        function showAddProductModal() {
            editingProductId = null;
            document.getElementById('productModalTitle').textContent = 'Tambah Produk';
            document.getElementById('productForm').reset();
            document.getElementById('productModal').style.display = 'flex';
        }

        function editProduct(productId) {
            const product = appData.products.find(p => p.id === productId);
            if (!product) return;
            
            editingProductId = productId;
            document.getElementById('productModalTitle').textContent = 'Edit Produk';
            document.getElementById('productName').value = product.name;
            document.getElementById('productBarcode').value = product.barcode;
            document.getElementById('productCategory').value = product.categoryId;
            document.getElementById('productUnit').value = product.unit;
            document.getElementById('productPurchasePrice').value = product.purchasePrice;
            document.getElementById('productSellPrice').value = product.sellPrice;
            document.getElementById('productStock').value = product.stock;
            document.getElementById('productMinStock').value = product.minStock;
            document.getElementById('productSupplier').value = product.supplierId || '';
            document.getElementById('productImage').value = product.image || '';
            
            document.getElementById('productModal').style.display = 'flex';
        }

        function closeProductModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        function saveProduct() {
            const name = document.getElementById('productName').value;
            const barcode = document.getElementById('productBarcode').value;
            const categoryId = parseInt(document.getElementById('productCategory').value);
            const unit = document.getElementById('productUnit').value;
            const purchasePrice = parseInt(document.getElementById('productPurchasePrice').value);
            const sellPrice = parseInt(document.getElementById('productSellPrice').value);
            const stock = parseInt(document.getElementById('productStock').value);
            const minStock = parseInt(document.getElementById('productMinStock').value);
            const supplierId = document.getElementById('productSupplier').value ? parseInt(document.getElementById('productSupplier').value) : null;
            const image = document.getElementById('productImage').value;
            
            if (!name || !categoryId || !unit || !purchasePrice || !sellPrice || isNaN(stock) || isNaN(minStock)) {
                showToast('Harap isi semua field yang wajib!', 'error');
                return;
            }
            
            if (editingProductId) {
                // Edit produk yang sudah ada
                const productIndex = appData.products.findIndex(p => p.id === editingProductId);
                if (productIndex !== -1) {
                    appData.products[productIndex] = {
                        ...appData.products[productIndex],
                        name,
                        barcode,
                        categoryId,
                        unit,
                        purchasePrice,
                        sellPrice,
                        stock,
                        minStock,
                        supplierId,
                        image
                    };
                }
                showToast('Produk berhasil diperbarui', 'success');
            } else {
                // Tambah produk baru
                const newId = appData.products.length > 0 ? Math.max(...appData.products.map(p => p.id)) + 1 : 1;
                appData.products.push({
                    id: newId,
                    name,
                    barcode,
                    categoryId,
                    unit,
                    purchasePrice,
                    sellPrice,
                    stock,
                    minStock,
                    supplierId,
                    image
                });
                showToast('Produk berhasil ditambahkan', 'success');
            }
            
            saveDataToStorage();
            updateProductGrid();
            updateProductCategoryOptions();
            updateStockProductOptions();
            closeProductModal();
        }

        function deleteProduct(productId) {
            if (confirm('Apakah Anda yakin ingin menghapus produk ini?')) {
                appData.products = appData.products.filter(p => p.id !== productId);
                saveDataToStorage();
                updateProductGrid();
                showToast('Produk berhasil dihapus', 'success');
            }
        }

        // Modal Kategori
        function showCategoriesModal() {
            updateCategoriesTable();
            document.getElementById('categoriesModal').style.display = 'flex';
        }

        function closeCategoriesModal() {
            document.getElementById('categoriesModal').style.display = 'none';
        }

        function addCategory() {
            const name = document.getElementById('newCategoryName').value;
            const unit = document.getElementById('newCategoryUnit').value;
            
            if (!name || !unit) {
                showToast('Harap isi nama kategori dan satuan!', 'error');
                return;
            }
            
            const newId = appData.categories.length > 0 ? Math.max(...appData.categories.map(c => c.id)) + 1 : 1;
            appData.categories.push({
                id: newId,
                name,
                unit
            });
            
            saveDataToStorage();
            updateCategoriesFilter();
            updateProductCategoryOptions();
            updateCategoriesTable();
            document.getElementById('newCategoryName').value = '';
            document.getElementById('newCategoryUnit').value = '';
            showToast('Kategori berhasil ditambahkan', 'success');
        }

        function updateCategoriesTable() {
            const tbody = document.getElementById('categoriesTableBody');
            tbody.innerHTML = '';
            
            appData.categories.forEach(category => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${category.name}</td>
                    <td>${category.unit}</td>
                    <td>
                        <button class="btn btn-sm btn-danger delete-category-btn" data-id="${category.id}">Hapus</button>
                    </td>
                `;
                
                row.querySelector('.delete-category-btn').addEventListener('click', function() {
                    deleteCategory(category.id);
                });
                
                tbody.appendChild(row);
            });
        }

        function deleteCategory(categoryId) {
            // Cek apakah kategori digunakan oleh produk
            const productsUsingCategory = appData.products.filter(p => p.categoryId === categoryId);
            
            if (productsUsingCategory.length > 0) {
                showToast('Tidak dapat menghapus kategori karena masih digunakan oleh produk!', 'error');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin menghapus kategori ini?')) {
                appData.categories = appData.categories.filter(c => c.id !== categoryId);
                saveDataToStorage();
                updateCategoriesFilter();
                updateProductCategoryOptions();
                updateCategoriesTable();
                showToast('Kategori berhasil dihapus', 'success');
            }
        }

        // Modal Stok
        function showStockModal() {
            switchStockTab('stockOpname');
            document.getElementById('stockModal').style.display = 'flex';
        }

        function closeStockModal() {
            document.getElementById('stockModal').style.display = 'none';
        }

        function switchStockTab(tabName) {
            // Sembunyikan semua tab content
            document.querySelectorAll('#stockModal .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Tampilkan tab content yang dipilih
            document.getElementById(tabName + 'Content').classList.add('active');
            
            // Update tab aktif
            document.querySelectorAll('#stockModal .tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                }
            });
            
            // Load data sesuai tab
            if (tabName === 'stockOpname') {
                loadStockOpnameData();
            } else if (tabName === 'stockHistory') {
                loadStockHistoryData();
            }
        }

        function loadStockOpnameData() {
            const tbody = document.getElementById('opnameTableBody');
            tbody.innerHTML = '';
            
            appData.products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.stock}</td>
                    <td><input type="number" class="form-control actual-stock-input" data-id="${product.id}" value="${product.stock}" min="0"></td>
                    <td class="difference-cell">0</td>
                `;
                
                // Event listener untuk input stok nyata
                row.querySelector('.actual-stock-input').addEventListener('input', function() {
                    const actualStock = parseInt(this.value) || 0;
                    const systemStock = product.stock;
                    const difference = actualStock - systemStock;
                    
                    row.querySelector('.difference-cell').textContent = difference;
                    if (difference < 0) {
                        row.querySelector('.difference-cell').classList.add('text-danger');
                        row.querySelector('.difference-cell').classList.remove('text-success');
                    } else if (difference > 0) {
                        row.querySelector('.difference-cell').classList.add('text-success');
                        row.querySelector('.difference-cell').classList.remove('text-danger');
                    } else {
                        row.querySelector('.difference-cell').classList.remove('text-danger', 'text-success');
                    }
                });
                
                tbody.appendChild(row);
            });
        }

        function startStockOpname() {
            const opnameDate = document.getElementById('opnameDate').value;
            const adjustments = [];
            
            // Kumpulkan data penyesuaian
            document.querySelectorAll('.actual-stock-input').forEach(input => {
                const productId = parseInt(input.getAttribute('data-id'));
                const actualStock = parseInt(input.value) || 0;
                const product = appData.products.find(p => p.id === productId);
                
                if (product) {
                    const systemStock = product.stock;
                    const difference = actualStock - systemStock;
                    
                    if (difference !== 0) {
                        adjustments.push({
                            productId,
                            productName: product.name,
                            systemStock,
                            actualStock,
                            difference,
                            date: opnameDate
                        });
                    }
                }
            });
            
            if (adjustments.length === 0) {
                showToast('Tidak ada penyesuaian stok yang diperlukan', 'info');
                return;
            }
            
            if (confirm(`Apakah Anda yakin ingin menyelesaikan stok opname? ${adjustments.length} produk akan disesuaikan.`)) {
                // Apply adjustments
                adjustments.forEach(adj => {
                    const product = appData.products.find(p => p.id === adj.productId);
                    if (product) {
                        // Update stok produk
                        product.stock = adj.actualStock;
                        
                        // Tambahkan ke riwayat stok
                        appData.stockHistory.push({
                            id: appData.stockHistory.length + 1,
                            productId: adj.productId,
                            productName: adj.productName,
                            type: adj.difference > 0 ? 'penambahan' : 'pengurangan',
                            quantity: Math.abs(adj.difference),
                            note: `Stok opname - ${opnameDate}`,
                            date: new Date().toISOString(),
                            userId: currentUser.username
                        });
                    }
                });
                
                saveDataToStorage();
                showToast('Stok opname berhasil diselesaikan', 'success');
                loadStockOpnameData();
            }
        }

        function loadStockHistoryData() {
            const dateFilter = document.getElementById('historyDateRange').value;
            const tbody = document.getElementById('stockHistoryTableBody');
            tbody.innerHTML = '';
            
            let filteredHistory = appData.stockHistory;
            
            if (dateFilter) {
                filteredHistory = filteredHistory.filter(record => {
                    const recordDate = new Date(record.date).toISOString().split('T')[0];
                    return recordDate === dateFilter;
                });
            }
            
            if (filteredHistory.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center">Tidak ada riwayat stok</td></tr>';
                return;
            }
            
            filteredHistory.forEach(record => {
                const date = new Date(record.date);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${date.toLocaleDateString('id-ID')}</td>
                    <td>${record.productName}</td>
                    <td>${record.type}</td>
                    <td>${record.quantity}</td>
                    <td>${record.note}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function addStock() {
            const productId = parseInt(document.getElementById('stockProduct').value);
            const quantity = parseInt(document.getElementById('stockQuantity').value);
            const note = document.getElementById('stockNote').value;
            
            if (!productId || isNaN(quantity) || quantity <= 0) {
                showToast('Harap pilih produk dan isi jumlah yang valid!', 'error');
                return;
            }
            
            const product = appData.products.find(p => p.id === productId);
            if (!product) return;
            
            // Update stok produk
            product.stock += quantity;
            
            // Tambahkan ke riwayat stok
            appData.stockHistory.push({
                id: appData.stockHistory.length + 1,
                productId,
                productName: product.name,
                type: 'penambahan',
                quantity,
                note: note || 'Penambahan stok manual',
                date: new Date().toISOString(),
                userId: currentUser.username
            });
            
            saveDataToStorage();
            updateProductGrid();
            document.getElementById('stockQuantity').value = 1;
            document.getElementById('stockNote').value = '';
            showToast(`Stok ${product.name} berhasil ditambahkan`, 'success');
        }

        // Modal Supplier
        function showSuppliersModal() {
            updateSuppliersTable();
            document.getElementById('suppliersModal').style.display = 'flex';
        }

        function closeSuppliersModal() {
            document.getElementById('suppliersModal').style.display = 'none';
        }

        function addSupplier() {
            const name = document.getElementById('supplierName').value;
            const contact = document.getElementById('supplierContact').value;
            const address = document.getElementById('supplierAddress').value;
            
            if (!name) {
                showToast('Harap isi nama supplier!', 'error');
                return;
            }
            
            const newId = appData.suppliers.length > 0 ? Math.max(...appData.suppliers.map(s => s.id)) + 1 : 1;
            appData.suppliers.push({
                id: newId,
                name,
                contact,
                address
            });
            
            saveDataToStorage();
            updateSupplierOptions();
            updateSuppliersTable();
            document.getElementById('supplierName').value = '';
            document.getElementById('supplierContact').value = '';
            document.getElementById('supplierAddress').value = '';
            showToast('Supplier berhasil ditambahkan', 'success');
        }

        function updateSuppliersTable() {
            const tbody = document.getElementById('suppliersTableBody');
            tbody.innerHTML = '';
            
            appData.suppliers.forEach(supplier => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${supplier.name}</td>
                    <td>${supplier.contact}</td>
                    <td>
                        <button class="btn btn-sm btn-danger delete-supplier-btn" data-id="${supplier.id}">Hapus</button>
                    </td>
                `;
                
                row.querySelector('.delete-supplier-btn').addEventListener('click', function() {
                    deleteSupplier(supplier.id);
                });
                
                tbody.appendChild(row);
            });
        }

        function deleteSupplier(supplierId) {
            // Cek apakah supplier digunakan oleh produk
            const productsUsingSupplier = appData.products.filter(p => p.supplierId === supplierId);
            
            if (productsUsingSupplier.length > 0) {
                showToast('Tidak dapat menghapus supplier karena masih digunakan oleh produk!', 'error');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin menghapus supplier ini?')) {
                appData.suppliers = appData.suppliers.filter(s => s.id !== supplierId);
                saveDataToStorage();
                updateSupplierOptions();
                updateSuppliersTable();
                showToast('Supplier berhasil dihapus', 'success');
            }
        }

        // Modal Member
        function showMembersModal() {
            switchMemberTab('memberList');
            document.getElementById('membersModal').style.display = 'flex';
        }

        function closeMembersModal() {
            document.getElementById('membersModal').style.display = 'none';
        }

        function switchMemberTab(tabName) {
            // Sembunyikan semua tab content
            document.querySelectorAll('#membersModal .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Tampilkan tab content yang dipilih
            document.getElementById(tabName + 'Content').classList.add('active');
            
            // Update tab aktif
            document.querySelectorAll('#membersModal .tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                }
            });
            
            // Load data sesuai tab
            if (tabName === 'memberList') {
                updateMembersTable();
            } else if (tabName === 'ktaCard') {
                // Tidak perlu melakukan apa-apa, kartu akan digenerate saat member dipilih
            }
        }

        function saveMember() {
            const name = document.getElementById('memberName').value;
            const phone = document.getElementById('memberPhone').value;
            const email = document.getElementById('memberEmail').value;
            const address = document.getElementById('memberAddress').value;
            
            if (!name || !phone) {
                showToast('Harap isi nama dan telepon member!', 'error');
                return;
            }
            
            const newId = appData.members.length > 0 ? Math.max(...appData.members.map(m => m.id)) + 1 : 1;
            appData.members.push({
                id: newId,
                name,
                phone,
                email: email || '',
                address: address || '',
                joinDate: new Date().toISOString(),
                points: 0
            });
            
            saveDataToStorage();
            updateMemberSelectOptions();
            updateKtaMemberSelect();
            updateMembersTable();
            document.getElementById('memberName').value = '';
            document.getElementById('memberPhone').value = '';
            document.getElementById('memberEmail').value = '';
            document.getElementById('memberAddress').value = '';
            showToast('Member berhasil ditambahkan', 'success');
        }

        function updateMembersTable() {
            const tbody = document.getElementById('membersTableBody');
            tbody.innerHTML = '';
            
            if (appData.members.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center">Tidak ada member</td></tr>';
                return;
            }
            
            appData.members.forEach(member => {
                const joinDate = new Date(member.joinDate);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${member.id}</td>
                    <td>${member.name}</td>
                    <td>${member.phone}</td>
                    <td>${member.points}</td>
                    <td>
                        <button class="btn btn-sm btn-danger delete-member-btn" data-id="${member.id}">Hapus</button>
                    </td>
                `;
                
                row.querySelector('.delete-member-btn').addEventListener('click', function() {
                    deleteMember(member.id);
                });
                
                tbody.appendChild(row);
            });
        }

        function deleteMember(memberId) {
            if (confirm('Apakah Anda yakin ingin menghapus member ini?')) {
                appData.members = appData.members.filter(m => m.id !== memberId);
                saveDataToStorage();
                updateMemberSelectOptions();
                updateKtaMemberSelect();
                updateMembersTable();
                showToast('Member berhasil dihapus', 'success');
            }
        }

        function generateKtaCard() {
            const memberId = parseInt(document.getElementById('ktaMemberSelect').value);
            const member = appData.members.find(m => m.id === memberId);
            const ktaCard = document.getElementById('ktaCard');
            const printBtn = document.getElementById('printKtaBtn');
            
            if (!member) {
                ktaCard.style.display = 'none';
                printBtn.style.display = 'none';
                return;
            }
            
            // Update informasi kartu
            document.getElementById('ktaStoreName').textContent = appData.settings.storeName;
            document.getElementById('ktaMemberName').textContent = member.name;
            document.getElementById('ktaMemberId').textContent = `ID: ${member.id.toString().padStart(6, '0')}`;
            
            // Generate QR code (simulasi)
            const qrCanvas = document.getElementById('ktaQrCode');
            const ctx = qrCanvas.getContext('2d');
            
            // Bersihkan canvas
            ctx.clearRect(0, 0, qrCanvas.width, qrCanvas.height);
            
            // Gambar QR code sederhana (simulasi)
            ctx.fillStyle = '#000';
            ctx.fillRect(10, 10, 140, 140);
            ctx.fillStyle = '#fff';
            ctx.fillRect(20, 20, 120, 120);
            ctx.fillStyle = '#000';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('MEMBER', 80, 60);
            ctx.font = '12px Arial';
            ctx.fillText(`ID: ${member.id}`, 80, 85);
            ctx.fillText(member.name.substring(0, 12), 80, 105);
            
            // Set tanggal kedaluwarsa (1 tahun dari sekarang)
            const expiryDate = new Date();
            expiryDate.setFullYear(expiryDate.getFullYear() + 1);
            document.getElementById('ktaExpiryDate').textContent = expiryDate.toLocaleDateString('id-ID');
            
            ktaCard.style.display = 'block';
            printBtn.style.display = 'inline-block';
        }

        function printKtaCard() {
            const printContainer = document.getElementById('print-container');
            const ktaCard = document.getElementById('ktaCard').cloneNode(true);
            
            printContainer.innerHTML = '';
            printContainer.appendChild(ktaCard);
            
            window.print();
        }

        // Modal User
        function showUsersModal() {
            switchUserTab('userList');
            document.getElementById('usersModal').style.display = 'flex';
        }

        function closeUsersModal() {
            document.getElementById('usersModal').style.display = 'none';
        }

        function switchUserTab(tabName) {
            // Sembunyikan semua tab content
            document.querySelectorAll('#usersModal .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Tampilkan tab content yang dipilih
            document.getElementById(tabName + 'Content').classList.add('active');
            
            // Update tab aktif
            document.querySelectorAll('#usersModal .tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                }
            });
            
            // Load data sesuai tab
            if (tabName === 'userList') {
                // Already handled by updateUsersTable
            } else if (tabName === 'shiftManagement') {
                updateShiftInfo();
                loadShiftHistory();
            }
        }

        function saveUser() {
            const username = document.getElementById('newUsername').value;
            const password = document.getElementById('newPassword').value;
            const fullName = document.getElementById('newFullName').value;
            const role = document.getElementById('newUserRole').value;
            
            if (!username || !password || !fullName) {
                showToast('Harap isi semua field!', 'error');
                return;
            }
            
            // Cek apakah username sudah ada
            const existingUser = appData.users.find(u => u.username === username);
            if (existingUser) {
                showToast('Username sudah digunakan!', 'error');
                return;
            }
            
            appData.users.push({
                username,
                password,
                fullName,
                role
            });
            
            saveDataToStorage();
            updateUsersTable();
            document.getElementById('newUsername').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('newFullName').value = '';
            showToast('User berhasil ditambahkan', 'success');
        }

        function updateUsersTable() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';
            
            appData.users.forEach(user => {
                // Jangan tampilkan user saat ini di daftar
                if (currentUser && user.username === currentUser.username) return;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.fullName}</td>
                    <td>${user.role}</td>
                    <td>Aktif</td>
                    <td>
                        <button class="btn btn-sm btn-danger delete-user-btn" data-username="${user.username}">Hapus</button>
                    </td>
                `;
                
                row.querySelector('.delete-user-btn').addEventListener('click', function() {
                    deleteUser(user.username);
                });
                
                tbody.appendChild(row);
            });
        }

        function deleteUser(username) {
            if (confirm('Apakah Anda yakin ingin menghapus user ini?')) {
                appData.users = appData.users.filter(u => u.username !== username);
                saveDataToStorage();
                updateUsersTable();
                showToast('User berhasil dihapus', 'success');
            }
        }

        // Modal Pembayaran
        function showPaymentModal() {
            if (currentOrder.items.length === 0) {
                showToast('Tidak ada item dalam pesanan!', 'error');
                return;
            }
            
            document.getElementById('paymentTotal').textContent = `Rp ${formatNumber(currentOrder.total)}`;
            document.getElementById('cashAmount').value = '';
            document.getElementById('changeGroup').style.display = 'none';
            document.getElementById('paymentModal').style.display = 'flex';
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').style.display = 'none';
        }

        function calculateChange() {
            const cashAmount = parseInt(document.getElementById('cashAmount').value) || 0;
            const change = cashAmount - currentOrder.total;
            const changeGroup = document.getElementById('changeGroup');
            const changeAmount = document.getElementById('changeAmount');
            
            if (cashAmount > 0 && change >= 0) {
                changeAmount.textContent = `Rp ${formatNumber(change)}`;
                changeGroup.style.display = 'block';
            } else {
                changeGroup.style.display = 'none';
            }
        }

        function confirmPayment() {
            const paymentMethod = document.getElementById('paymentMethod').value;
            let cashAmount = 0;
            
            if (paymentMethod === 'cash') {
                cashAmount = parseInt(document.getElementById('cashAmount').value) || 0;
                
                if (cashAmount < currentOrder.total) {
                    showToast('Jumlah uang tidak mencukupi!', 'error');
                    return;
                }
            }
            
            // Generate ID transaksi
            const now = new Date();
            const transactionId = `TRX-${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}-${appData.transactions.length + 1}`;
            
            // Simpan transaksi
            const transaction = {
                id: transactionId,
                date: now.toISOString(),
                items: [...currentOrder.items],
                subtotal: currentOrder.subtotal,
                tax: currentOrder.tax,
                discount: currentOrder.discount,
                total: currentOrder.total,
                paymentMethod,
                cashAmount,
                change: paymentMethod === 'cash' ? cashAmount - currentOrder.total : 0,
                member: currentOrder.member,
                note: document.getElementById('orderNote').value,
                userId: currentUser.username
            };
            
            appData.transactions.push(transaction);
            
            // Update poin member jika ada
            if (currentOrder.member) {
                const member = appData.members.find(m => m.id === currentOrder.member.id);
                if (member) {
                    // 1 poin untuk setiap Rp 10.000 pembelian
                    const pointsEarned = Math.floor(currentOrder.total / 10000);
                    member.points += pointsEarned;
                }
            }
            
            // Tambahkan ke riwayat shift jika shift aktif
            if (appData.currentShift) {
                appData.currentShift.transactions.push(transactionId);
            }
            
            saveDataToStorage();
            
            // Tampilkan struk
            showReceipt(transaction);
            
            // Reset pesanan
            currentOrder = {
                items: [],
                member: null,
                note: "",
                subtotal: 0,
                discount: 0,
                tax: 0,
                total: 0
            };
            
            // Reset UI
            document.getElementById('memberSearch').value = '';
            document.getElementById('selectedMemberInfo').style.display = 'none';
            document.getElementById('orderNote').value = '';
            
            updateOrderDisplay();
            closePaymentModal();
            showToast('Pembayaran berhasil!', 'success');
        }

        // Modal Donasi
        function showDonationModal() {
            document.getElementById('donationModal').style.display = 'flex';
        }

        function closeDonationModal() {
            document.getElementById('donationModal').style.display = 'none';
        }

        function confirmDonation() {
            const amount = parseInt(document.getElementById('donationAmount').value);
            const note = document.getElementById('donationNote').value;
            
            if (isNaN(amount) || amount < 1000) {
                showToast('Jumlah donasi minimal Rp 1.000!', 'error');
                return;
            }
            
            // Simpan donasi
            const donation = {
                id: appData.donations.length + 1,
                amount,
                note: note || 'Donasi',
                date: new Date().toISOString(),
                userId: currentUser.username
            };
            
            appData.donations.push(donation);
            saveDataToStorage();
            
            // Tampilkan struk donasi
            showDonationReceipt(donation);
            
            closeDonationModal();
            showToast('Donasi berhasil dicatat!', 'success');
        }

        // Modal Backup & Restore
        function showBackupModal() {
            document.getElementById('backupModal').style.display = 'flex';
        }

        function closeBackupModal() {
            document.getElementById('backupModal').style.display = 'none';
        }

        function backupData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `backup-supermarket-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showToast('Backup data berhasil!', 'success');
        }

        function enableRestoreButton() {
            document.getElementById('restoreDataBtn').disabled = false;
        }

        function restoreData() {
            const fileInput = document.getElementById('restoreFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showToast('Pilih file backup terlebih dahulu!', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const restoredData = JSON.parse(e.target.result);
                    
                    // Validasi data
                    if (!restoredData.products || !restoredData.categories) {
                        throw new Error('Format file backup tidak valid');
                    }
                    
                    if (confirm('Apakah Anda yakin ingin mengembalikan data dari backup? Data saat ini akan diganti.')) {
                        appData = restoredData;
                        saveDataToStorage();
                        initializeApp();
                        showToast('Data berhasil dikembalikan dari backup!', 'success');
                        document.getElementById('restoreDataBtn').disabled = true;
                        fileInput.value = '';
                    }
                } catch (error) {
                    showToast('Gagal memproses file backup: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function resetData() {
            if (confirm('PERINGATAN: Apakah Anda yakin ingin mereset semua data? Tindakan ini tidak dapat dibatalkan!')) {
                localStorage.removeItem('supermarketAppData');
                appData = {
                    products: [],
                    categories: [
                        { id: 1, name: "Makanan", unit: "pcs" },
                        { id: 2, name: "Minuman", unit: "botol" },
                        { id: 3, name: "Elektronik", unit: "unit" },
                        { id: 4, name: "Peralatan Rumah Tangga", unit: "pcs" }
                    ],
                    suppliers: [
                        { id: 1, name: "Supplier A", contact: "08123456789", address: "Jl. Supplier No. 1" },
                        { id: 2, name: "Supplier B", contact: "08234567890", address: "Jl. Supplier No. 2" }
                    ],
                    members: [],
                    users: [
                        { username: "admin", password: "admin123", fullName: "Administrator", role: "admin" },
                        { username: "kasir1", password: "kasir123", fullName: "Kasir Satu", role: "kasir" }
                    ],
                    transactions: [],
                    donations: [],
                    stockHistory: [],
                    shifts: [],
                    currentShift: null,
                    settings: {
                        storeName: "SUPERMARKET",
                        storeAddress: "Jl. Contoh No. 123, Kota Contoh",
                        storePhone: "(021) 123-4567",
                        taxRate: 10
                    }
                };
                initializeApp();
                showToast('Data berhasil direset!', 'success');
            }
        }

        // Modal Laporan Komprehensif
        function showComprehensiveReportsModal() {
            document.getElementById('comprehensiveReportsModal').style.display = 'flex';
            generateReportPreview();
        }

        function closeComprehensiveReportsModal() {
            document.getElementById('comprehensiveReportsModal').style.display = 'none';
        }

        function generateReportPreview() {
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const preview = document.getElementById('reportPreview');
            
            let reportHTML = '';
            
            switch (currentReportType) {
                case 'dailySales':
                    reportHTML = generateDailySalesReport(startDate, endDate);
                    break;
                case 'salesProfit':
                    reportHTML = generateSalesProfitReport(startDate, endDate);
                    break;
                case 'returnsStock':
                    reportHTML = generateReturnsStockReport(startDate, endDate);
                    break;
                case 'donations':
                    reportHTML = generateDonationsReport(startDate, endDate);
                    break;
                case 'members':
                    reportHTML = generateMembersReport();
                    break;
            }
            
            preview.innerHTML = reportHTML;
        }

        function generateDailySalesReport(startDate, endDate) {
            // Filter transaksi berdasarkan tanggal
            const filteredTransactions = appData.transactions.filter(transaction => {
                const transactionDate = new Date(transaction.date).toISOString().split('T')[0];
                return (!startDate || transactionDate >= startDate) && (!endDate || transactionDate <= endDate);
            });
            
            // Kelompokkan berdasarkan tanggal dan shift
            const dailySales = {};
            filteredTransactions.forEach(transaction => {
                const date = new Date(transaction.date).toISOString().split('T')[0];
                if (!dailySales[date]) {
                    dailySales[date] = {
                        date,
                        totalSales: 0,
                        transactionCount: 0,
                        shifts: {}
                    };
                }
                
                dailySales[date].totalSales += transaction.total;
                dailySales[date].transactionCount += 1;
                
                // Kelompokkan berdasarkan user (shift)
                const userId = transaction.userId;
                if (!dailySales[date].shifts[userId]) {
                    dailySales[date].shifts[userId] = {
                        user: userId,
                        totalSales: 0,
                        transactionCount: 0
                    };
                }
                
                dailySales[date].shifts[userId].totalSales += transaction.total;
                dailySales[date].shifts[userId].transactionCount += 1;
            });
            
            let html = `<h4>Laporan Harian Penjualan</h4>`;
            html += `<p>Periode: ${startDate || 'Semua'} hingga ${endDate || 'Semua'}</p>`;
            html += `<table class="data-table"><thead><tr><th>Tanggal</th><th>Jumlah Transaksi</th><th>Total Penjualan</th><th>Shift</th></tr></thead><tbody>`;
            
            Object.values(dailySales).forEach(day => {
                html += `<tr><td>${day.date}</td><td>${day.transactionCount}</td><td>Rp ${formatNumber(day.totalSales)}</td><td>`;
                
                Object.values(day.shifts).forEach(shift => {
                    const user = appData.users.find(u => u.username === shift.user);
                    html += `${user ? user.fullName : shift.user}: ${shift.transactionCount} transaksi (Rp ${formatNumber(shift.totalSales)})<br>`;
                });
                
                html += `</td></tr>`;
            });
            
            html += `</tbody></table>`;
            return html;
        }

        function generateSalesProfitReport(startDate, endDate) {
            // Filter transaksi berdasarkan tanggal
            const filteredTransactions = appData.transactions.filter(transaction => {
                const transactionDate = new Date(transaction.date).toISOString().split('T')[0];
                return (!startDate || transactionDate >= startDate) && (!endDate || transactionDate <= endDate);
            });
            
            // Hitung total penjualan, laba, dan jumlah transaksi
            let totalSales = 0;
            let totalProfit = 0;
            let transactionCount = filteredTransactions.length;
            
            filteredTransactions.forEach(transaction => {
                totalSales += transaction.total;
                
                // Hitung laba per transaksi
                let transactionProfit = 0;
                transaction.items.forEach(item => {
                    const product = appData.products.find(p => p.id === item.productId);
                    if (product) {
                        transactionProfit += (item.price - product.purchasePrice) * item.quantity;
                    }
                });
                totalProfit += transactionProfit;
            });
            
            let html = `<h4>Laporan Penjualan dan Laba Rugi</h4>`;
            html += `<p>Periode: ${startDate || 'Semua'} hingga ${endDate || 'Semua'}</p>`;
            html += `<table class="data-table"><thead><tr><th>Metrik</th><th>Nilai</th></tr></thead><tbody>`;
            html += `<tr><td>Jumlah Transaksi</td><td>${transactionCount}</td></tr>`;
            html += `<tr><td>Total Penjualan</td><td>Rp ${formatNumber(totalSales)}</td></tr>`;
            html += `<tr><td>Total Laba Kotor</td><td>Rp ${formatNumber(totalProfit)}</td></tr>`;
            html += `<tr><td>Rata-rata per Transaksi</td><td>Rp ${formatNumber(transactionCount > 0 ? totalSales / transactionCount : 0)}</td></tr>`;
            html += `</tbody></table>`;
            
            return html;
        }

        function generateReturnsStockReport(startDate, endDate) {
            // Filter riwayat stok berdasarkan tanggal
            const filteredStockHistory = appData.stockHistory.filter(record => {
                const recordDate = new Date(record.date).toISOString().split('T')[0];
                return (!startDate || recordDate >= startDate) && (!endDate || recordDate <= endDate);
            });
            
            let html = `<h4>Laporan Retur dan Penambahan Stok</h4>`;
            html += `<p>Periode: ${startDate || 'Semua'} hingga ${endDate || 'Semua'}</p>`;
            html += `<table class="data-table"><thead><tr><th>Tanggal</th><th>Produk</th><th>Jenis</th><th>Jumlah</th><th>Keterangan</th><th>Petugas</th></tr></thead><tbody>`;
            
            if (filteredStockHistory.length === 0) {
                html += `<tr><td colspan="6" class="text-center">Tidak ada data</td></tr>`;
            } else {
                filteredStockHistory.forEach(record => {
                    const date = new Date(record.date).toLocaleDateString('id-ID');
                    html += `<tr><td>${date}</td><td>${record.productName}</td><td>${record.type}</td><td>${record.quantity}</td><td>${record.note}</td><td>${record.userId}</td></tr>`;
                });
            }
            
            html += `</tbody></table>`;
            return html;
        }

        function generateDonationsReport(startDate, endDate) {
            // Filter donasi berdasarkan tanggal
            const filteredDonations = appData.donations.filter(donation => {
                const donationDate = new Date(donation.date).toISOString().split('T')[0];
                return (!startDate || donationDate >= startDate) && (!endDate || donationDate <= endDate);
            });
            
            let html = `<h4>Laporan Donasi</h4>`;
            html += `<p>Periode: ${startDate || 'Semua'} hingga ${endDate || 'Semua'}</p>`;
            html += `<table class="data-table"><thead><tr><th>Tanggal</th><th>Jumlah Donasi</th><th>Keterangan</th><th>Petugas</th></tr></thead><tbody>`;
            
            if (filteredDonations.length === 0) {
                html += `<tr><td colspan="4" class="text-center">Tidak ada data</td></tr>`;
            } else {
                let totalDonations = 0;
                filteredDonations.forEach(donation => {
                    const date = new Date(donation.date).toLocaleDateString('id-ID');
                    html += `<tr><td>${date}</td><td>Rp ${formatNumber(donation.amount)}</td><td>${donation.note}</td><td>${donation.userId}</td></tr>`;
                    totalDonations += donation.amount;
                });
                
                html += `<tr><td colspan="4" class="text-center"><strong>Total Donasi: Rp ${formatNumber(totalDonations)}</strong></td></tr>`;
            }
            
            html += `</tbody></table>`;
            return html;
        }

        function generateMembersReport() {
            let html = `<h4>Laporan Data Member</h4>`;
            html += `<table class="data-table"><thead><tr><th>ID</th><th>Nama</th><th>Telepon</th><th>Email</th><th>Alamat</th><th>Tanggal Bergabung</th><th>Poin</th></tr></thead><tbody>`;
            
            if (appData.members.length === 0) {
                html += `<tr><td colspan="7" class="text-center">Tidak ada data</td></tr>`;
            } else {
                appData.members.forEach(member => {
                    const joinDate = new Date(member.joinDate).toLocaleDateString('id-ID');
                    html += `<tr><td>${member.id}</td><td>${member.name}</td><td>${member.phone}</td><td>${member.email || '-'}</td><td>${member.address || '-'}</td><td>${joinDate}</td><td>${member.points}</td></tr>`;
                });
            }
            
            html += `</tbody></table>`;
            return html;
        }

        function printComprehensiveReport() {
            const printContainer = document.getElementById('print-container');
            const reportPreview = document.getElementById('reportPreview').cloneNode(true);
            
            // Tambahkan header laporan
            const header = document.createElement('div');
            header.innerHTML = `
                <h2>Laporan Komprehensif - ${appData.settings.storeName}</h2>
                <p>Dibuat pada: ${new Date().toLocaleDateString('id-ID')} ${new Date().toLocaleTimeString('id-ID')}</p>
                <p>Oleh: ${currentUser.fullName}</p>
                <hr>
            `;
            
            printContainer.innerHTML = '';
            printContainer.appendChild(header);
            printContainer.appendChild(reportPreview);
            
            window.print();
        }

        function downloadComprehensiveReportPdf() {
            const doc = new jsPDF();
            const reportTitle = `Laporan Komprehensif - ${appData.settings.storeName}`;
            const dateInfo = `Dibuat pada: ${new Date().toLocaleDateString('id-ID')} oleh: ${currentUser.fullName}`;
            
            // Judul laporan
            doc.setFontSize(16);
            doc.text(reportTitle, 14, 15);
            doc.setFontSize(10);
            doc.text(dateInfo, 14, 22);
            
            // Untuk sementara, kita simpan HTML sebagai teks
            const reportContent = document.getElementById('reportPreview').textContent;
            const lines = doc.splitTextToSize(reportContent, 180);
            doc.text(lines, 14, 30);
            
            doc.save(`laporan-komprehensif-${new Date().toISOString().split('T')[0]}.pdf`);
            showToast('Laporan berhasil diunduh sebagai PDF', 'success');
        }

        function downloadComprehensiveReportExcel() {
            // Simulasi download Excel (dalam implementasi nyata, gunakan library seperti SheetJS)
            showToast('Fitur download Excel akan segera tersedia', 'info');
        }

        // Fungsi untuk menampilkan struk
        function showReceipt(transaction) {
            const receiptStoreName = document.getElementById('receiptStoreName');
            const receiptStoreAddress = document.getElementById('receiptStoreAddress');
            const receiptStorePhone = document.getElementById('receiptStorePhone');
            const receiptDate = document.getElementById('receiptDate');
            const receiptCashier = document.getElementById('receiptCashier');
            const receiptId = document.getElementById('receiptId');
            const receiptItemsContainer = document.getElementById('receiptItemsContainer');
            const receiptTotal = document.getElementById('receiptTotal');
            const receiptPayment = document.getElementById('receiptPayment');
            const receiptChange = document.getElementById('receiptChange');
            
            // Set informasi toko
            receiptStoreName.textContent = appData.settings.storeName;
            receiptStoreAddress.textContent = appData.settings.storeAddress;
            receiptStorePhone.textContent = appData.settings.storePhone;
            
            // Set informasi transaksi
            const date = new Date(transaction.date);
            receiptDate.textContent = `${date.toLocaleDateString('id-ID')} ${date.toLocaleTimeString('id-ID')}`;
            receiptCashier.textContent = transaction.userId;
            receiptId.textContent = transaction.id;
            
            // Set item transaksi
            receiptItemsContainer.innerHTML = '';
            transaction.items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'receipt-item';
                itemElement.innerHTML = `
                    <div class="receipt-item-details">
                        <div class="item-name">${item.name}</div>
                        <div class="item-price-calc">${item.quantity} ${item.unit} x Rp ${formatNumber(item.price)}</div>
                    </div>
                    <div>Rp ${formatNumber(item.price * item.quantity)}</div>
                `;
                receiptItemsContainer.appendChild(itemElement);
            });
            
            // Set total, pembayaran, dan kembalian
            receiptTotal.textContent = `Rp ${formatNumber(transaction.total)}`;
            receiptPayment.textContent = `Rp ${formatNumber(transaction.cashAmount)}`;
            receiptChange.textContent = `Rp ${formatNumber(transaction.change)}`;
            
            // Tampilkan modal struk
            document.getElementById('receiptModal').style.display = 'flex';
        }

        function showDonationReceipt(donation) {
            // Buat struk donasi sederhana
            const receiptContent = document.getElementById('receiptContent');
            const originalContent = receiptContent.innerHTML;
            
            const donationReceipt = `
                <div class="receipt-header">
                    <div class="receipt-title">${appData.settings.storeName}</div>
                    <div>${appData.settings.storeAddress}</div>
                    <div>${appData.settings.storePhone}</div>
                </div>
                
                <div class="receipt-info">
                    <div>
                        <span>Tanggal:</span>
                        <span>${new Date(donation.date).toLocaleDateString('id-ID')}</span>
                    </div>
                    <div>
                        <span>Jenis:</span>
                        <span>DONASI</span>
                    </div>
                    <div>
                        <span>ID Donasi:</span>
                        <span>DON-${donation.id}</span>
                    </div>
                </div>
                
                <div class="receipt-item">
                    <span>Jumlah Donasi:</span>
                    <span>Rp ${formatNumber(donation.amount)}</span>
                </div>
                
                <div class="receipt-item">
                    <span>Keterangan:</span>
                    <span>${donation.note}</span>
                </div>
                
                <div class="receipt-footer">
                    <div>Terima kasih atas donasi Anda</div>
                    <div>Semoga menjadi amal jariyah</div>
                </div>
            `;
            
            receiptContent.innerHTML = donationReceipt;
            document.getElementById('receiptModal').style.display = 'flex';
            
            // Kembalikan konten asli setelah modal ditutup
            document.getElementById('closeReceiptBtn').onclick = function() {
                receiptContent.innerHTML = originalContent;
                closeReceiptModal();
            };
        }

        function closeReceiptModal() {
            document.getElementById('receiptModal').style.display = 'none';
        }

        function printReceipt() {
            const printContainer = document.getElementById('print-container');
            const receiptContent = document.getElementById('receiptContent').cloneNode(true);
            
            printContainer.innerHTML = '';
            printContainer.appendChild(receiptContent);
            
            window.print();
        }

        // Fungsi untuk manajemen shift
        function updateShiftInfo() {
            const shiftInfo = document.getElementById('shiftInfo');
            const currentShiftStatus = document.getElementById('currentShiftStatus');
            const startShiftSection = document.getElementById('startShiftSection');
            const endShiftSection = document.getElementById('endShiftSection');
            const currentShiftStatusDisplay = document.getElementById('currentShiftStatusDisplay');
            const currentShiftUser = document.getElementById('currentShiftUser');
            const currentShiftBalance = document.getElementById('currentShiftBalance');
            
            if (appData.currentShift) {
                shiftInfo.innerHTML = `Shift: <span id="currentShiftStatus" class="shift-active">Aktif</span>`;
                currentShiftStatusDisplay.textContent = 'Aktif';
                currentShiftUser.textContent = appData.currentShift.userId;
                currentShiftBalance.textContent = `Rp ${formatNumber(appData.currentShift.startBalance)}`;
                startShiftSection.style.display = 'none';
                endShiftSection.style.display = 'block';
            } else {
                shiftInfo.innerHTML = `Shift: <span id="currentShiftStatus" class="shift-inactive">Tidak Aktif</span>`;
                currentShiftStatusDisplay.textContent = 'Tidak Aktif';
                currentShiftUser.textContent = '-';
                currentShiftBalance.textContent = 'Rp 0';
                startShiftSection.style.display = 'block';
                endShiftSection.style.display = 'none';
            }
        }

        function startShift() {
            const startBalance = parseInt(document.getElementById('shiftStartBalance').value) || 0;
            
            if (startBalance < 0) {
                showToast('Saldo awal tidak boleh negatif!', 'error');
                return;
            }
            
            appData.currentShift = {
                id: appData.shifts.length + 1,
                startTime: new Date().toISOString(),
                userId: currentUser.username,
                startBalance,
                transactions: [],
                endTime: null,
                endBalance: null
            };
            
            saveDataToStorage();
            updateShiftInfo();
            showToast('Shift berhasil dimulai', 'success');
        }

        function endShift() {
            const endBalance = parseInt(document.getElementById('shiftEndBalance').value) || 0;
            
            if (endBalance < 0) {
                showToast('Saldo akhir tidak boleh negatif!', 'error');
                return;
            }
            
            if (!appData.currentShift) {
                showToast('Tidak ada shift yang aktif!', 'error');
                return;
            }
            
            appData.currentShift.endTime = new Date().toISOString();
            appData.currentShift.endBalance = endBalance;
            
            // Simpan shift ke riwayat
            appData.shifts.push({...appData.currentShift});
            appData.currentShift = null;
            
            saveDataToStorage();
            updateShiftInfo();
            loadShiftHistory();
            showToast('Shift berhasil diakhiri', 'success');
        }

        function loadShiftHistory() {
            const tbody = document.getElementById('shiftHistoryTableBody');
            tbody.innerHTML = '';
            
            if (appData.shifts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center">Tidak ada riwayat shift</td></tr>';
                return;
            }
            
            appData.shifts.slice().reverse().forEach(shift => {
                const startDate = new Date(shift.startTime);
                const endDate = shift.endTime ? new Date(shift.endTime) : null;
                const status = shift.endTime ? 'Selesai' : 'Aktif';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${startDate.toLocaleDateString('id-ID')}</td>
                    <td>${shift.userId}</td>
                    <td>Rp ${formatNumber(shift.startBalance)}</td>
                    <td>${shift.endBalance ? `Rp ${formatNumber(shift.endBalance)}` : '-'}</td>
                    <td>${status}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Fungsi utilitas
        function formatNumber(num) {
            return new Intl.NumberFormat('id-ID').format(num);
        }

        function getCategoryName(categoryId) {
            const category = appData.categories.find(c => c.id === categoryId);
            return category ? category.name : 'Tidak terkategori';
        }

        function updateProductCategoryOptions() {
            const select = document.getElementById('productCategory');
            select.innerHTML = '<option value="">Pilih Kategori</option>';
            
            appData.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                select.appendChild(option);
            });
        }

        function updateSupplierOptions() {
            const select = document.getElementById('productSupplier');
            select.innerHTML = '<option value="">Pilih Supplier</option>';
            
            appData.suppliers.forEach(supplier => {
                const option = document.createElement('option');
                option.value = supplier.id;
                option.textContent = supplier.name;
                select.appendChild(option);
            });
        }

        function updateMemberSelectOptions() {
            const select = document.getElementById('ktaMemberSelect');
            select.innerHTML = '<option value="">Pilih Member</option>';
            
            appData.members.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = `${member.name} (ID: ${member.id})`;
                select.appendChild(option);
            });
        }

        function updateKtaMemberSelect() {
            // Sama dengan updateMemberSelectOptions, untuk konsistensi
            updateMemberSelectOptions();
        }

        function updateStockProductOptions() {
            const select = document.getElementById('stockProduct');
            select.innerHTML = '<option value="">Pilih Produk</option>';
            
            appData.products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = product.name;
                select.appendChild(option);
            });
        }

        // Fungsi untuk mencetak laporan stok opname
        function printOpnameReport() {
            const printContainer = document.getElementById('print-container');
            const opnameDate = document.getElementById('opnameDate').value;
            
            let html = `
                <h2>Laporan Stok Opname</h2>
                <p>Tanggal: ${opnameDate}</p>
                <p>Toko: ${appData.settings.storeName}</p>
                <p>Dibuat oleh: ${currentUser.fullName}</p>
                <table border="1" style="width:100%; border-collapse:collapse;">
                    <thead>
                        <tr>
                            <th>Produk</th>
                            <th>Stok Sistem</th>
                            <th>Stok Nyata</th>
                            <th>Selisih</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            document.querySelectorAll('#opnameTableBody tr').forEach(row => {
                const cells = row.querySelectorAll('td');
                html += `
                    <tr>
                        <td>${cells[0].textContent}</td>
                        <td>${cells[1].textContent}</td>
                        <td>${cells[2].querySelector('input').value}</td>
                        <td>${cells[3].textContent}</td>
                    </tr>
                `;
            });
            
            html += `</tbody></table>`;
            printContainer.innerHTML = html;
            window.print();
        }

        function downloadOpnamePdf() {
            const doc = new jsPDF();
            const opnameDate = document.getElementById('opnameDate').value;
            
            doc.text(`Laporan Stok Opname - ${appData.settings.storeName}`, 14, 15);
            doc.text(`Tanggal: ${opnameDate}`, 14, 25);
            doc.text(`Dibuat oleh: ${currentUser.fullName}`, 14, 35);
            
            // Buat tabel
            const headers = [['Produk', 'Stok Sistem', 'Stok Nyata', 'Selisih']];
            const data = [];
            
            document.querySelectorAll('#opnameTableBody tr').forEach(row => {
                const cells = row.querySelectorAll('td');
                data.push([
                    cells[0].textContent,
                    cells[1].textContent,
                    cells[2].querySelector('input').value,
                    cells[3].textContent
                ]);
            });
            
            doc.autoTable({
                head: headers,
                body: data,
                startY: 45
            });
            
            doc.save(`stok-opname-${opnameDate}.pdf`);
            showToast('Laporan stok opname berhasil diunduh', 'success');
        }

        function printHistoryReport() {
            const printContainer = document.getElementById('print-container');
            const historyDate = document.getElementById('historyDateRange').value;
            
            let html = `
                <h2>Laporan Riwayat Stok</h2>
                <p>Tanggal: ${historyDate || 'Semua'}</p>
                <p>Toko: ${appData.settings.storeName}</p>
                <p>Dibuat oleh: ${currentUser.fullName}</p>
                <table border="1" style="width:100%; border-collapse:collapse;">
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Produk</th>
                            <th>Jenis</th>
                            <th>Qty</th>
                            <th>Keterangan</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            document.querySelectorAll('#stockHistoryTableBody tr').forEach(row => {
                const cells = row.querySelectorAll('td');
                html += `
                    <tr>
                        <td>${cells[0].textContent}</td>
                        <td>${cells[1].textContent}</td>
                        <td>${cells[2].textContent}</td>
                        <td>${cells[3].textContent}</td>
                        <td>${cells[4].textContent}</td>
                    </tr>
                `;
            });
            
            html += `</tbody></table>`;
            printContainer.innerHTML = html;
            window.print();
        }

        function downloadHistoryPdf() {
            const doc = new jsPDF();
            const historyDate = document.getElementById('historyDateRange').value;
            
            doc.text(`Laporan Riwayat Stok - ${appData.settings.storeName}`, 14, 15);
            doc.text(`Tanggal: ${historyDate || 'Semua'}`, 14, 25);
            doc.text(`Dibuat oleh: ${currentUser.fullName}`, 14, 35);
            
            // Buat tabel
            const headers = [['Tanggal', 'Produk', 'Jenis', 'Qty', 'Keterangan']];
            const data = [];
            
            document.querySelectorAll('#stockHistoryTableBody tr').forEach(row => {
                const cells = row.querySelectorAll('td');
                data.push([
                    cells[0].textContent,
                    cells[1].textContent,
                    cells[2].textContent,
                    cells[3].textContent,
                    cells[4].textContent
                ]);
            });
            
            doc.autoTable({
                head: headers,
                body: data,
                startY: 45
            });
            
            doc.save(`riwayat-stok-${historyDate || 'all'}.pdf`);
            showToast('Laporan riwayat stok berhasil diunduh', 'success');
        }

        // Fungsi untuk menampilkan histori transaksi
        function showHistoryModal() {
            updateTransactionHistory();
            document.getElementById('historyModal').style.display = 'flex';
        }

        function closeHistoryModal() {
            document.getElementById('historyModal').style.display = 'none';
        }

        function updateTransactionHistory() {
            const dateFilter = document.getElementById('historyDateFilter').value;
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '';
            
            let filteredTransactions = appData.transactions;
            
            if (dateFilter) {
                filteredTransactions = filteredTransactions.filter(transaction => {
                    const transactionDate = new Date(transaction.date).toISOString().split('T')[0];
                    return transactionDate === dateFilter;
                });
            }
            
            if (filteredTransactions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center">Tidak ada transaksi</td></tr>';
                return;
            }
            
            filteredTransactions.slice().reverse().forEach(transaction => {
                const date = new Date(transaction.date);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${date.toLocaleDateString('id-ID')}</td>
                    <td>${transaction.id}</td>
                    <td>Rp ${formatNumber(transaction.total)}</td>
                    <td>${transaction.userId}</td>
                    <td>
                        <button class="btn btn-sm btn-info view-receipt-btn" data-id="${transaction.id}">Lihat</button>
                    </td>
                `;
                
                row.querySelector('.view-receipt-btn').addEventListener('click', function() {
                    viewReceipt(transaction.id);
                });
                
                tbody.appendChild(row);
            });
        }

        function viewReceipt(transactionId) {
            const transaction = appData.transactions.find(t => t.id === transactionId);
            if (transaction) {
                showReceipt(transaction);
            }
        }

        function printTransactionHistory() {
            const printContainer = document.getElementById('print-container');
            const dateFilter = document.getElementById('historyDateFilter').value;
            
            let html = `
                <h2>Laporan Histori Transaksi</h2>
                <p>Tanggal: ${dateFilter || 'Semua'}</p>
                <p>Toko: ${appData.settings.storeName}</p>
                <p>Dibuat oleh: ${currentUser.fullName}</p>
                <table border="1" style="width:100%; border-collapse:collapse;">
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>ID Transaksi</th>
                            <th>Total</th>
                            <th>Kasir</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            let filteredTransactions = appData.transactions;
            
            if (dateFilter) {
                filteredTransactions = filteredTransactions.filter(transaction => {
                    const transactionDate = new Date(transaction.date).toISOString().split('T')[0];
                    return transactionDate === dateFilter;
                });
            }
            
            filteredTransactions.slice().reverse().forEach(transaction => {
                const date = new Date(transaction.date);
                html += `
                    <tr>
                        <td>${date.toLocaleDateString('id-ID')}</td>
                        <td>${transaction.id}</td>
                        <td>Rp ${formatNumber(transaction.total)}</td>
                        <td>${transaction.userId}</td>
                    </tr>
                `;
            });
            
            html += `</tbody></table>`;
            printContainer.innerHTML = html;
            window.print();
        }

        // Inisialisasi data contoh jika tidak ada data
        function initializeSampleData() {
            if (appData.products.length === 0) {
                appData.products = [
                    {
                        id: 1,
                        name: "Beras Premium 5kg",
                        barcode: "1234567890123",
                        categoryId: 1,
                        unit: "karung",
                        purchasePrice: 50000,
                        sellPrice: 55000,
                        stock: 10,
                        minStock: 5,
                        supplierId: 1,
                        image: ""
                    },
                    {
                        id: 2,
                        name: "Minyak Goreng 2L",
                        barcode: "1234567890124",
                        categoryId: 1,
                        unit: "botol",
                        purchasePrice: 25000,
                        sellPrice: 28000,
                        stock: 20,
                        minStock: 10,
                        supplierId: 1,
                        image: ""
                    },
                    {
                        id: 3,
                        name: "Aqua Botol 600ml",
                        barcode: "1234567890125",
                        categoryId: 2,
                        unit: "botol",
                        purchasePrice: 3000,
                        sellPrice: 4000,
                        stock: 50,
                        minStock: 20,
                        supplierId: 2,
                        image: ""
                    },
                    {
                        id: 4,
                        name: "Indomie Goreng",
                        barcode: "1234567890126",
                        categoryId: 1,
                        unit: "pcs",
                        purchasePrice: 2500,
                        sellPrice: 3000,
                        stock: 100,
                        minStock: 50,
                        supplierId: 1,
                        image: ""
                    }
                ];
                
                appData.members = [
                    {
                        id: 1,
                        name: "Budi Santoso",
                        phone: "081234567890",
                        email: "budi@email.com",
                        address: "Jl. Merdeka No. 123",
                        joinDate: new Date().toISOString(),
                        points: 150
                    }
                ];
                
                saveDataToStorage();
            }
        }

        // Panggil fungsi inisialisasi data contoh
        initializeSampleData();
    </script>
</body>
</html>
