<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Data Produk - Anekamarket</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-color: #dee2e6;
        }
        body { font-family: 'Poppins', sans-serif; background-color: #f4f7f9; color: var(--dark-color); line-height: 1.6; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h1, h2, h3 { color: var(--primary-color); margin-top: 0; border-bottom: 2px solid var(--border-color); padding-bottom: 10px; margin-bottom: 20px; }
        h1 { text-align: center; font-size: 2rem; }
        h2 { font-size: 1.5rem; margin-top: 30px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 600; margin-bottom: 8px; color: #555; }
        input[type="text"], input[type="number"], input[type="url"], textarea, select { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem; transition: border-color 0.3s, box-shadow 0.3s; box-sizing: border-box; }
        input[type="text"]:focus, input[type="number"]:focus, input[type="url"]:focus, textarea:focus, select:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2); outline: none; }
        textarea { resize: vertical; min-height: 120px; }
        .btn { display: inline-block; padding: 12px 24px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; text-align: center; text-decoration: none; transition: background-color 0.3s, transform 0.2s; color: #fff; }
        .btn:hover { transform: translateY(-2px); }
        .btn-primary { background-color: var(--primary-color); }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-success { background-color: var(--success-color); }
        .btn-success:hover { background-color: #218838; }
        .btn-danger { background-color: var(--danger-color); }
        .btn-danger:hover { background-color: #c82333; }
        .btn-secondary { background-color: var(--secondary-color); color: #fff;}
        .btn-secondary:hover { background-color: #5a6268; }
        .dynamic-list { border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; margin-top: 10px; }
        .dynamic-item { display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: center; padding: 15px 0; border-bottom: 1px solid #eee; }
        .dynamic-item:first-child { padding-top: 0; }
        .dynamic-item:last-child { border-bottom: none; padding-bottom: 0; }
        .price-variation-item { grid-template-columns: 1fr 1fr auto; }
        .spec-item { grid-template-columns: 1fr 2fr auto; }
        .btn-remove { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; padding: 0; }
        .output-container { margin-top: 30px; }
        #jsonOutput { width: 100%; height: 400px; font-family: monospace; font-size: 0.9rem; white-space: pre; background-color: #2d2d2d; color: #f1f1f1; border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; box-sizing: border-box; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .full-width { grid-column: 1 / -1; }
        .action-buttons { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; }
        .file-input-wrapper { position: relative; overflow: hidden; display: inline-block; }
        .file-input-wrapper input[type=file] { font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; }
        #fileName { margin-left: 10px; font-style: italic; color: var(--secondary-color); }
        @media (max-width: 768px) {
            .grid-2, .dynamic-item, .price-variation-item, .spec-item { grid-template-columns: 1fr; }
            .btn-remove { margin-top: 10px; width: 100%; }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1><i class="fas fa-cogs"></i> Generator Data Produk Anekamarket</h1>
        
        <div id="restoreSection">
            <h2><i class="fas fa-upload"></i> Edit / Restore Data Produk</h2>
            <p>Punya file script produk sebelumnya? Unggah di sini untuk mengeditnya.</p>
            <div class="form-group">
                <div class="file-input-wrapper btn btn-secondary">
                    <i class="fas fa-folder-open"></i> Pilih File (.txt/.json)
                    <input type="file" id="restoreFile" accept=".txt,.json">
                </div>
                <span id="fileName">Belum ada file dipilih.</span>
            </div>
        </div>

        <form id="productForm">
            <h2><i class="fas fa-box-open"></i> Informasi Dasar</h2>
            <div class="grid-2">
                <div class="form-group"><label for="id">ID Produk (Otomatis)</label><input type="text" id="id" placeholder="cth: AWF-2025-2575" readonly></div>
                <div class="form-group"><label for="code">Kode Produk</label><input type="text" id="code" placeholder="cth: AWF-2025-2575" required></div>
                <div class="form-group"><label for="title">Judul Produk</label><input type="text" id="title" placeholder="cth: Paket Lengkap Ternak Ayam" required></div>
                <div class="form-group"><label for="category">Kategori</label><select id="category"><option value="food">Makanan & Minuman</option><option value="snack">Kue & Cemilan</option><option value="construction">Alat Konstruksi</option><option value="office">Alat Kantor</option><option value="household">Alat Rumah Tangga</option><option value="software">Software Aplikasi</option><option value="electronics">Elektronik</option><option value="fishery">Perikanan</option><option value="livestock">Peternakan</option><option value="agriculture">Pertanian</option></select></div>
                <div class="form-group"><label for="type">Tipe Tampilan</label><select id="type"><option value="all">Semua</option><option value="rental">Sewa</option><option value="promo">Promosi</option></select></div>
                <div class="form-group"><label for="mainImage">URL Gambar Utama</label><input type="url" id="mainImage" placeholder="https://i.imgur.com/..." required></div>
            </div>
            <div class="form-group"><label for="description">Deskripsi Produk (HTML didukung)</label><textarea id="description" placeholder="Jelaskan produk Anda secara detail..."></textarea></div>

            <h2><i class="fas fa-store"></i> Informasi Penjual (Gerai)</h2>
            <div class="grid-2">
                <div class="form-group full-width"><label for="sellerName">Nama Penjual / Gerai</label><input type="text" id="sellerName" placeholder="cth: Ardiwillis Farm" required></div>
                <div class="form-group full-width">
                    <label>Link Gerai (Bisa lebih dari satu)</label>
                    <div class="dynamic-list" id="sellerLinksContainer"></div>
                    <button type="button" class="btn btn-secondary" id="addSellerLink" style="margin-top:15px;"><i class="fas fa-plus"></i> Tambah Link Gerai</button>
                </div>
                <div class="form-group"><label for="contactWhatsapp">No. WhatsApp</label><input type="text" id="contactWhatsapp" placeholder="cth: 6285XXXXXXXXX" required></div>
                <div class="form-group"><label for="contactPhone">No. Telepon</label><input type="text" id="contactPhone" placeholder="cth: +6285XXXXXXXXX" required></div>
            </div>

            <h2><i class="fas fa-dollar-sign"></i> Informasi Harga</h2>
            <div class="grid-2">
                <div class="form-group"><label for="price">Harga Awal (Mulai dari)</label><input type="number" id="price" placeholder="cth: 8000" required></div>
                <div class="form-group"><label for="originalPrice">Harga Asli (dicoret, kosongkan jika tidak ada)</label><input type="number" id="originalPrice" placeholder="cth: 10000"></div>
                <div class="form-group full-width"><label for="discount">Teks Diskon</label><input type="text" id="discount" placeholder="cth: 10% OFF"></div>
            </div>
            
            <h3>Variasi Harga</h3>
            <div class="dynamic-list" id="priceVariationsContainer"></div>
            <button type="button" class="btn btn-secondary" id="addPriceVariation" style="margin-top:15px;"><i class="fas fa-plus"></i> Tambah Variasi Harga</button>

            <h2><i class="fas fa-balance-scale"></i> Unit Produk</h2>
            <div class="grid-2">
                <div class="form-group"><label for="units">Satuan Unit (pisahkan dengan koma)</label><input type="text" id="units" placeholder="cth: pcs,kg,biji,ekor" required></div>
                <div class="form-group"><label for="defaultUnit">Unit Default</label><input type="text" id="defaultUnit" placeholder="cth: ekor" required></div>
            </div>
            
            <h2><i class="fas fa-certificate"></i> Badge / Label</h2>
            <div class="grid-2">
                <div class="form-group"><label for="badgeText">Teks Badge</label><input type="text" id="badgeText" placeholder="cth: Promosi" required></div>
                <div class="form-group"><label for="badgeType">Tipe Badge</label><select id="badgeType"><option value="promo">Promo (Merah)</option><option value="new">Baru (Biru)</option><option value="rental">Lainnya (Abu-abu)</option></select></div>
            </div>

            <h2><i class="fas fa-info-circle"></i> Detail Lanjutan</h2>
            <h3>Gambar Tambahan</h3>
            <div class="dynamic-list" id="imagesContainer"></div>
            <button type="button" class="btn btn-secondary" id="addImage" style="margin-top:15px;"><i class="fas fa-plus"></i> Tambah Gambar</button>
            <h3 style="margin-top: 20px;">Spesifikasi</h3>
            <div class="dynamic-list" id="specsContainer"></div>
            <button type="button" class="btn btn-secondary" id="addSpec" style="margin-top:15px;"><i class="fas fa-plus"></i> Tambah Spesifikasi</button>
        </form>

        <div class="output-container">
            <h2><i class="fas fa-code"></i> Hasil Script (JSON)</h2>
            <p>Salin kode di bawah ini dan tempelkan ke dalam array `products` di file website Anda.</p>
            <textarea id="jsonOutput" readonly></textarea>
            <div class="action-buttons">
                <button type="button" class="btn btn-primary" id="generateBtn"><i class="fas fa-play"></i> Generate Script</button>
                <button type="button" class="btn btn-success" id="downloadBtn"><i class="fas fa-download"></i> Unduh File (.txt)</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('productForm');

        function addDynamicItem(containerId, itemHtml, focusNew = true) {
            const container = document.getElementById(containerId);
            container.insertAdjacentHTML('beforeend', itemHtml);
            if (focusNew) {
                const newInputs = container.lastElementChild.querySelectorAll('input, textarea');
                if (newInputs.length > 0) newInputs[0].focus();
            }
        }

        document.body.addEventListener('click', function(e) {
            const removeBtn = e.target.closest('.btn-remove');
            if (removeBtn) removeBtn.closest('.dynamic-item').remove();
        });

        document.getElementById('addSellerLink').addEventListener('click', () => addDynamicItem('sellerLinksContainer', `<div class="dynamic-item"><input type="url" class="seller-link" placeholder="https://www.anekamarket.my.id/..." required><button type="button" class="btn btn-danger btn-remove"><i class="fas fa-trash"></i></button></div>`));
        document.getElementById('addPriceVariation').addEventListener('click', () => addDynamicItem('priceVariationsContainer', `<div class="dynamic-item price-variation-item"><input type="text" class="price-variation-name" placeholder="Nama Variasi" required><input type="number" class="price-variation-price" placeholder="Harga" required><button type="button" class="btn btn-danger btn-remove"><i class="fas fa-trash"></i></button></div>`));
        document.getElementById('addImage').addEventListener('click', () => addDynamicItem('imagesContainer', `<div class="dynamic-item"><input type="url" class="image-url" placeholder="https://i.imgur.com/..." required><button type="button" class="btn btn-danger btn-remove"><i class="fas fa-trash"></i></button></div>`));
        document.getElementById('addSpec').addEventListener('click', () => addDynamicItem('specsContainer', `<div class="dynamic-item spec-item"><input type="text" class="spec-label" placeholder="Label (cth: Jenis)" required><input type="text" class="spec-value" placeholder="Value (cth: Ayam Pedaging)" required><button type="button" class="btn btn-danger btn-remove"><i class="fas fa-trash"></i></button></div>`));
        
        document.getElementById('code').addEventListener('input', e => { document.getElementById('id').value = e.target.value; });

        function generateJson() {
             if (!form.checkValidity()) {
                alert('Harap isi semua kolom yang wajib diisi (ditandai dengan required).');
                form.reportValidity();
                return null;
            }
            
            const sellerLinks = Array.from(document.querySelectorAll('#sellerLinksContainer .seller-link')).map(input => input.value).filter(Boolean);
            if (sellerLinks.length === 0) {
                 alert('Harap tambahkan minimal satu Link Gerai.');
                 document.getElementById('addSellerLink').focus();
                 return null;
            }

            const productData = {
                id: document.getElementById('id').value,
                category: document.getElementById('category').value,
                type: document.getElementById('type').value,
                seller: {
                    name: document.getElementById('sellerName').value,
                    links: sellerLinks
                },
                badge: { text: document.getElementById('badgeText').value, type: document.getElementById('badgeType').value },
                mainImage: document.getElementById('mainImage').value,
                title: document.getElementById('title').value,
                code: document.getElementById('code').value,
                price: parseFloat(document.getElementById('price').value),
                originalPrice: document.getElementById('originalPrice').value ? parseFloat(document.getElementById('originalPrice').value) : null,
                discount: document.getElementById('discount').value || null,
                priceVariations: Array.from(document.querySelectorAll('#priceVariationsContainer .dynamic-item')).map(item => ({ name: item.querySelector('.price-variation-name').value, price: parseFloat(item.querySelector('.price-variation-price').value) })),
                units: document.getElementById('units').value.split(',').map(u => u.trim()),
                defaultUnit: document.getElementById('defaultUnit').value,
                details: {
                    description: document.getElementById('description').value,
                    images: Array.from(document.querySelectorAll('#imagesContainer .image-url')).map(input => input.value),
                    specs: Array.from(document.querySelectorAll('#specsContainer .dynamic-item')).map(item => ({ label: item.querySelector('.spec-label').value, value: item.querySelector('.spec-value').value }))
                },
                contact: { whatsapp: document.getElementById('contactWhatsapp').value, phone: document.getElementById('contactPhone').value }
            };

            const jsonString = JSON.stringify(productData, null, 4);
            document.getElementById('jsonOutput').value = jsonString;
            return jsonString;
        }

        document.getElementById('generateBtn').addEventListener('click', generateJson);

        document.getElementById('downloadBtn').addEventListener('click', function() {
            const jsonString = generateJson();
            if (!jsonString) {
                alert('Gagal membuat file unduhan karena data belum lengkap.');
                return;
            }
            const blob = new Blob([jsonString], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${document.getElementById('code').value || 'product-data'}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
        
        const restoreFileInput = document.getElementById('restoreFile');
        const fileNameSpan = document.getElementById('fileName');

        restoreFileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) {
                fileNameSpan.textContent = 'Belum ada file dipilih.';
                return;
            }
            fileNameSpan.textContent = file.name;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    populateForm(data);
                } catch (error) {
                    alert(`File tidak valid atau format JSON salah. Pastikan file berasal dari generator ini.\n\nDetail Error: ${error.message}`);
                    console.error("Error parsing JSON:", error);
                    fileNameSpan.textContent = 'File gagal dimuat.';
                }
            };
            reader.readAsText(file);
        });

        function populateForm(data) {
            try {
                // Bersihkan semua list dinamis
                ['sellerLinksContainer', 'priceVariationsContainer', 'imagesContainer', 'specsContainer'].forEach(id => {
                    document.getElementById(id).innerHTML = '';
                });

                // Helper untuk mengisi nilai dengan aman
                const setValue = (id, value) => {
                    const el = document.getElementById(id);
                    if (el) el.value = value || '';
                };
                
                // Isi field standar
                setValue('id', data.id);
                setValue('code', data.code);
                setValue('title', data.title);
                setValue('category', data.category || 'food');
                setValue('type', data.type || 'all');
                setValue('mainImage', data.mainImage);
                setValue('description', data.details?.description);
                setValue('sellerName', data.seller?.name);
                setValue('contactWhatsapp', data.contact?.whatsapp);
                setValue('contactPhone', data.contact?.phone);
                setValue('price', data.price);
                setValue('originalPrice', data.originalPrice);
                setValue('discount', data.discount);
                setValue('units', data.units?.join(','));
                setValue('defaultUnit', data.defaultUnit);
                setValue('badgeText', data.badge?.text);
                setValue('badgeType', data.badge?.type || 'promo');

                // [FIX] Logika robust untuk mengisi link gerai (mendukung format lama dan baru)
                const linksToPopulate = data.seller?.links || (data.seller?.link ? [data.seller.link] : []);
                linksToPopulate.forEach(link => addDynamicItem('sellerLinksContainer', `<div class="dynamic-item"><input type="url" class="seller-link" value="${link}" required><button type="button" class="btn btn-danger btn-remove"><i class="fas fa-trash"></i></button></div>`, false));

                (data.priceVariations || []).forEach(pv => addDynamicItem('priceVariationsContainer', `<div class="dynamic-item price-variation-item"><input type="text" class="price-variation-name" value="${pv.name || ''}" required><input type="number" class="price-variation-price" value="${pv.price || ''}" required><button type="button" class="btn btn-danger btn-remove"><i class="fas fa-trash"></i></button></div>`, false));
                (data.details?.images || []).forEach(img => addDynamicItem('imagesContainer', `<div class="dynamic-item"><input type="url" class="image-url" value="${img}" required><button type="button" class="btn btn-danger btn-remove"><i class="fas fa-trash"></i></button></div>`, false));
                (data.details?.specs || []).forEach(spec => addDynamicItem('specsContainer', `<div class="dynamic-item spec-item"><input type="text" class="spec-label" value="${spec.label || ''}" required><input type="text" class="spec-value" value="${spec.value || ''}" required><button type="button" class="btn btn-danger btn-remove"><i class="fas fa-trash"></i></button></div>`, false));
                
                alert('Data berhasil dimuat ke dalam formulir. Anda sekarang bisa mengeditnya.');

            } catch(error) {
                alert(`Terjadi kesalahan saat memuat data ke formulir. Pastikan struktur file JSON benar.\n\nDetail Error: ${error.message}`);
                console.error("Error populating form:", error);
            }
        }
    });
    </script>
</body>
</html>
