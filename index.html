<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulir Pendaftaran & Perjanjian Mitra ANEKAMARKET</title>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Source+Sans+Pro:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        /* --- [BAGIAN 1: CSS DARI index.html] --- */
        :root {
            --primary-color: #007BFF;
            --primary-gradient: linear-gradient(90deg, #007BFF 0%, #0056b3 100%);
            --primary-hover-color: #0056b3;
            --dark-color: #212529;
            --gray-color: #6c757d;
            --light-color: #f8f9fa;
            --white-color: #ffffff;
            --success-color: #28a745;
            --error-color: #dc3545;
            --warning-color: #ffc107;
            --border-color: #dee2e6;
            --border-radius: 12px;
            --shadow: 0 12px 35px rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: var(--dark-color);
            line-height: 1.6;
            background: linear-gradient(135deg, var(--light-color) 0%, #e0eafc 100%);
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .container {
            max-width: 850px; /* Diperlebar sedikit untuk form perjanjian */
            width: 100%;
            background: var(--white-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin: 20px 0;
            border: none;
        }
        
        /* Kontainer untuk layar sukses */
        #success-container {
            text-align: center; 
            padding: 40px 20px;
        }

        .header {
            padding: 30px 40px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--white-color);
        }

        .header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .header p {
            font-size: 1rem;
            font-weight: 400;
            color: var(--gray-color);
            margin-top: 5px;
        }

        .logo-img {
            max-width: 150px;
            height: auto;
            margin-bottom: 15px;
        }

        .form-container {
            padding: 30px 40px;
        }

        .form-section {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
        }
        .form-section:last-of-type { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        
        .form-section h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-color);
            padding-left: 10px;
        }

        .form-group { margin-bottom: 20px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem; 
        }
        .required::after { content: " *"; color: var(--error-color); }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background: var(--white-color);
            color: var(--dark-color);
            font-weight: 400;
        }
        input::placeholder, textarea::placeholder { color: #adb5bd; }
        
        input:focus, select:focus, textarea:focus { 
            outline: none; 
            border-color: var(--primary-color); 
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15);
        }
        textarea { resize: vertical; min-height: 80px; }

        input[readonly] {
            background-color: var(--light-color);
            border: 1px solid var(--border-color);
            padding: 12px 15px;
            border-radius: 8px;
            cursor: not-allowed;
            color: var(--gray-color);
            box-shadow: none;
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        .file-input-wrapper:hover { border-color: var(--primary-color); }
        .file-input-wrapper input[type="file"] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }
        .file-input-label {
            color: var(--gray-color);
            font-weight: 500;
        }
        #file-name {
            display: block;
            margin-top: 10px;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
            padding: 10px 0;
        }
        .checkbox-group input { display: none; }
        .checkbox-group label { margin-bottom: 0; font-size: 0.95rem; cursor: pointer; font-weight: 500; color: var(--dark-color); }
        .checkbox-custom {
            height: 22px; width: 22px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            display: inline-block;
            margin-right: 12px;
            position: relative;
            transition: all 0.2s ease-in-out;
            flex-shrink: 0;
        }
        .checkbox-group input:checked + .checkbox-custom {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            transform: scale(1.05);
        }
        .checkbox-custom::after {
            content: '';
            position: absolute;
            left: 6px; top: 2px;
            width: 6px; height: 12px;
            border: solid var(--white-color);
            border-width: 0 3px 3px 0;
            transform: rotate(45deg) scale(0);
            opacity: 0;
            transition: all 0.2s ease-in-out;
        }
        .checkbox-group input:checked + .checkbox-custom::after {
            transform: rotate(45deg) scale(1);
            opacity: 1;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 14px 30px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            font-size: 1.05rem;
            text-align: center;
            margin-top: 20px;
        }
        .btn-primary {
            background: var(--primary-gradient);
            color: var(--white-color);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
        }
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0, 123, 255, 0.3);
        }
        .btn-primary:disabled {
            background: #adb5bd;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: var(--white-color);
            font-size: 0.9rem;
            padding: 10px 15px;
            margin-top: 10px;
            width: auto;
        }
        .btn-secondary:hover { background-color: #5a6268; }

        .btn-location {
            background-color: var(--success-color);
            color: var(--white-color);
            font-size: 0.9rem;
            padding: 10px 15px;
            margin-top: 10px;
            width: auto;
        }
        .btn-location:hover { background-color: #218838; }

        .location-button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .location-warning {
            padding: 15px;
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            border-radius: 8px;
            color: #856404;
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-align: center;
        }

        .error-message, .status-message { color: var(--error-color); font-size: 0.8rem; margin-top: 5px; font-weight: 500; display: none; }
        .status-message { color: var(--dark-color); }

        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; gap: 0; }
            .header h1 { font-size: 1.5rem; }
            .form-container, .header { padding: 25px 20px; }
            .location-button-group { flex-direction: column; }
            .btn { width: 100%; }
        }

        /* --- [BAGIAN 2: CSS DARI perjanjian.html] --- */
        
        /* Container khusus untuk perjanjian */
        #agreement-form-container {
            font-family: 'Source Sans Pro', sans-serif;
            line-height: 1.5;
            color: #333;
            background-color: white;
            position: relative;
        }

        #agreement-form-container .form-container {
            max-width: 100%;
            padding: 0;
            box-shadow: none;
        }
        
        /* Premium Border Effect */
        #agreement-form-container::before {
            content: "";
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 2px solid #c9ad6a;
            pointer-events: none;
            z-index: 1;
        }
        
        /* Watermark Styles */
        #agreement-form-container .watermark {
            position: absolute;
            opacity: 0.03;
            font-size: 80px; /* Disesuaikan */
            font-weight: bold;
            color: #000;
            transform: rotate(-45deg);
            pointer-events: none;
            z-index: 0;
            top: 40%;
            left: 15%;
            white-space: nowrap;
            font-family: 'Playfair Display', serif;
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        /* Header Styles - VERSI PREMIUM */
        #agreement-form-container .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            position: relative;
            border-bottom: 3px double #1a3d7c;
            background-color: transparent;
        }
                
        #agreement-form-container .logo-img {
            height: 80px;
            width: auto;
            margin-bottom: 10px;
        }
        
        #agreement-form-container .company-name {
            color: #1a3d7c;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Playfair Display', serif;
        }
        
        #agreement-form-container .company-tagline {
            font-size: 14px;
            font-style: italic;
            margin-bottom: 8px;
            color: #555;
        }
        
        #agreement-form-container .company-address {
            font-size: 13px;
            margin-bottom: 5px;
            color: #444;
        }
        
        #agreement-form-container .contact-info {
            font-size: 12px;
            margin: 5px 0;
            color: #444;
        }
        
        #agreement-form-container .contact-info span {
            display: inline-block;
            margin: 0 5px;
        }
        
        #agreement-form-container .header-line {
            height: 1px;
            background: linear-gradient(to right, transparent, #1a3d7c, transparent);
            margin: 10px 0;
        }
        
        /* Document Title Styles */
        #agreement-form-container .document-title {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin: 20px 0;
            color: #ff0000;
            font-family: 'Playfair Display', serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 8px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
        }
        
        #agreement-form-container .document-number {
            text-align: center;
            margin-bottom: 25px;
            font-style: normal;
            color: #000;
            font-weight: bold;
            font-size: 14px;
        }
        
        /* Parties Styles */
        #agreement-form-container .parties {
            margin-bottom: 25px;
        }
        
        #agreement-form-container .party {
            margin-bottom: 15px;
            padding: 12px;
            background-color: #f9f9f9;
            border-left: 4px solid #1a3d7c;
        }
        
        #agreement-form-container .party-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #1a3d7c;
            font-size: 16px;
            font-family: 'Playfair Display', serif;
        }
        
        #agreement-form-container .party p {
            margin-bottom: 6px;
            padding-left: 8px;
            font-size: 14px;
        }
        
        /* Article Styles */
        #agreement-form-container .article {
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }
        
        #agreement-form-container .article-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #1a3d7c;
            font-size: 16px;
            font-family: 'Playfair Display', serif;
            padding-bottom: 3px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        #agreement-form-container .article p, #agreement-form-container .article ul {
            margin-bottom: 8px;
            text-align: justify;
            font-size: 14px;
        }
        
        #agreement-form-container .article ul {
            margin-left: 20px;
            list-style-position: inside;
        }
        
        /* Signature Area Styles */
        #agreement-form-container .signature-area {
            margin-top: 40px;
            display: flex;
            justify-content: space-between;
            position: relative;
            z-index: 2;
            page-break-inside: avoid;
        }
        
        #agreement-form-container .signature-box {
            width: 48%;
            text-align: center;
            padding: 15px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 320px;
        }
        
        #agreement-form-container .signature-info {
            margin-bottom: 15px;
            color: #000;
            font-weight: 500;
            font-size: 14px;
        }
        
        #agreement-form-container .qrcode-container {
            margin: 15px auto;
            width: 100px;
            height: 100px;
            border: 1px solid #ddd;
            padding: 5px;
            background: white;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #agreement-form-container .signature-name {
            margin-top: 15px;
            font-weight: bold;
            display: inline-block;
            min-width: 180px;
            border-top: 1px solid #333;
            padding-top: 8px;
            color: #000;
            font-size: 14px;
        }
        
        /* Form Styles */
        .no-print {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 8px;
            position: relative;
            z-index: 2;
            border: 1px solid #ddd;
        }
        
        #agreement-form-container .no-print .form-group {
             margin-bottom: 15px;
        }
        
        #agreement-form-container .no-print label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #444;
            font-size: 14px;
        }
        
        #agreement-form-container .no-print input[type="text"],
        #agreement-form-container .no-print input[type="date"],
        #agreement-form-container .no-print input[type="tel"],
        #agreement-form-container .no-print select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        #agreement-form-container .no-print input[type="text"]:focus,
        #agreement-form-container .no-print input[type="date"]:focus,
        #agreement-form-container .no-print input[type="tel"]:focus,
        #agreement-form-container .no-print select:focus {
            border-color: #1a3d7c;
            outline: none;
            box-shadow: 0 0 0 2px rgba(26, 61, 124, 0.2);
        }
        
        #agreement-form-container .no-print input.uppercase {
            text-transform: uppercase;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        /* Menggunakan style .btn dari index.html agar seragam */
        .button-group button {
            background-color: #1a3d7c;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            flex: 1;
            min-width: 180px;
            font-weight: 600;
            margin-top: 0; /* Reset margin-top */
            width: auto; /* Reset width */
        }
        
        .button-group button:hover {
            background-color: #153265;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .button-group button.print { background-color: #2e7d32; }
        .button-group button.print:hover { background-color: #245a28; }
        .button-group button.download { background-color: #7b1fa2; }
        .button-group button.download:hover { background-color: #641a87; }
        .button-group button.whatsapp { background-color: #25D366; }
        .button-group button.whatsapp:hover { background-color: #1da851; }
        
        /* Menyembunyikan grup tombol (Sesuai permintaan) */
        #agreement-form-container .no-print .button-group {
            display: none;
        }

        .error-message.agreement-error {
            color: #d9534f;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }
        
        .input-error { border-color: #d9534f !important; }
        
        .loading {
            display: none;
            text-align: center;
            padding: 12px;
            color: #1a3d7c;
            font-weight: 600;
            font-size: 14px;
        }
        
        /* Security Pattern */
        #agreement-form-container .security-pattern {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 0;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23000000' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        
        /* Form Input Display in Document */
        #agreement-form-container .form-input {
            font-weight: 600;
            color: #1a3d7c;
            padding: 0 4px 2px;
            display: inline-block;
            font-size: 14px;
            min-height: 20px;
        }
        
        /* Page Number for Print */
        #agreement-form-container .page-number {
            display: none;
        }

        /* Tombol Navigasi Step */
        .step-navigation {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 30px;
        }
        
        @media (max-width: 900px) {
            #agreement-form-container { padding: 20px; }
            #agreement-form-container .header { text-align: center; padding: 10px; margin-bottom: 15px; }
            #agreement-form-container .logo-img { height: 60px; margin-bottom: 5px; }
            #agreement-form-container .company-name { font-size: 16px; margin-bottom: 3px; }
            #agreement-form-container .company-tagline { font-size: 12px; margin-bottom: 5px; }
            #agreement-form-container .company-address { font-size: 11px; margin-bottom: 3px; }
            #agreement-form-container .contact-info { font-size: 10px; margin: 3px 0; }
            #agreement-form-container .contact-info span { display: block; margin: 2px 0; }
            #agreement-form-container .signature-area { flex-direction: column; gap: 20px; margin-top: 30px; }
            #agreement-form-container .signature-box { width: 100%; padding: 10px; min-height: 280px; }
            .button-group { flex-direction: column; }
            .button-group button { width: 100%; min-width: auto; }
            #agreement-form-container .watermark { font-size: 50px; top: 30%; left: 5%; }
            #agreement-form-container .document-title { font-size: 16px; margin: 15px 0; padding: 5px; }
            #agreement-form-container .document-number { font-size: 12px; margin-bottom: 15px; }
            #agreement-form-container .party { padding: 8px; margin-bottom: 10px; }
            #agreement-form-container .party-title { font-size: 14px; }
            #agreement-form-container .party p { font-size: 13px; margin-bottom: 4px; }
            #agreement-form-container .article-title { font-size: 14px; }
            #agreement-form-container .article p, #agreement-form-container .article ul { font-size: 13px; margin-bottom: 6px; }
            #agreement-form-container .qrcode-container { width: 80px; height: 80px; margin: 10px auto; }
            #agreement-form-container .signature-name { min-width: 150px; font-size: 13px; margin-top: 10px; padding-top: 5px; }
        }
        
        /* --- [BAGIAN 3: PRINT STYLES DARI perjanjian.html] --- */
        @media print {
            @page {
                size: A4;
                margin: 15mm 10mm 15mm 10mm;
                font-family: 'Source Sans Pro', sans-serif;
                font-size: 14px;
                line-height: 1.5;
                color: #000 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                
                @bottom-center {
                    content: "Halaman " counter(page) " dari " counter(pages);
                    font-size: 11px;
                    color: #666;
                    margin-top: 10px;
                }
            }
            
            body {
                padding: 0 !important;
                margin: 0 !important;
                background: white !important;
                color: #000 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                font-size: 14px;
                line-height: 1.5;
                width: 100% !important;
                height: auto !important;
                overflow: visible !important;
            }
            
            /* Sembunyikan semua kecuali dokumen perjanjian */
            .no-print, #registration-container, .header:not(#agreement-form-container .header), .step-navigation, #submitBtn, #nextBtn, #prevBtn, #finalSubmitBtn {
                display: none !important;
            }

            .container {
                max-width: 100% !important;
                box-shadow: none !important;
                border: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            #agreement-form-container {
                display: block !important;
                padding: 0 !important;
            }
            
            #agreement-document {
                display: block !important;
            }
            
            #agreement-form-container .form-container {
                box-shadow: none !important;
                padding: 0 !important;
                max-width: 100% !important;
                border: none !important;
                background-image: none !important;
                margin: 0 !important;
                width: 100% !important;
                height: auto !important;
                overflow: visible !important;
                page-break-inside: avoid;
                break-inside: avoid;
            }
            
            #agreement-form-container::before {
                display: none !important;
            }
            
            button {
                display: none !important;
            }
            
            * {
                color: #000 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            #agreement-form-container .header {
                text-align: center;
                padding: 0 0 8px 0;
                margin-bottom: 15px;
                border-bottom: 2px double #000 !important;
                page-break-inside: avoid;
                page-break-after: avoid;
                page-break-before: avoid;
                break-inside: avoid;
                break-after: avoid;
                break-before: avoid;
                background: white !important;
                box-shadow: none !important;
                border: none !important;
                margin: 0 0 15px 0 !important;
                width: 100% !important;
                max-width: 100% !important;
                overflow: hidden !important;
                position: relative;
                z-index: 9999;
            }
            
            #agreement-form-container .logo-img {
                height: 70px !important;
                margin-bottom: 5px;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                filter: contrast(120%) brightness(90%);
            }
            
            #agreement-form-container .company-name { font-size: 18px !important; margin-bottom: 3px; color: #000 !important; font-weight: bold; }
            #agreement-form-container .company-tagline { font-size: 13px !important; margin-bottom: 4px; color: #000 !important; }
            #agreement-form-container .company-address { font-size: 12px !important; margin-bottom: 3px; color: #000 !important; }
            #agreement-form-container .contact-info { font-size: 11px !important; margin: 2px 0; color: #000 !important; }
            #agreement-form-container .contact-info span { display: inline-block; margin: 0 3px; }
            #agreement-form-container .header-line { height: 0.5px; background: #000 !important; margin: 6px 0; }
            #agreement-form-container .watermark { opacity: 0.05 !important; font-size: 80px !important; top: 35% !important; left: 10% !important; color: #000 !important; }
            #agreement-form-container .security-pattern { opacity: 0.02 !important; }
            
            #agreement-form-container .party {
                background-color: transparent !important;
                border-left: 3px solid #000 !important;
                padding: 10px;
                margin-bottom: 15px;
                page-break-inside: avoid;
                break-inside: avoid;
            }
            
            #agreement-form-container .party-title { color: #000 !important; font-size: 15px !important; margin-bottom: 8px; }
            #agreement-form-container .party p { font-size: 14px !important; margin-bottom: 5px; color: #000 !important; }
            
            #agreement-form-container .signature-box {
                border: 1px solid #000 !important;
                background-color: transparent !important;
                padding: 12px;
                page-break-inside: avoid;
                break-inside: avoid;
                min-height: 300px !important;
                width: 48% !important;
            }
            
            #agreement-form-container .document-title {
                border: 1px solid #000 !important;
                background-color: transparent !important;
                padding: 8px;
                margin: 15px 0;
                font-size: 18px !important;
                page-break-inside: avoid;
                break-inside: avoid;
                color: #ff0000 !important;
            }
            
            #agreement-form-container .document-number { font-size: 13px !important; margin-bottom: 20px; color: #000 !important; }
            #agreement-form-container .article, #agreement-form-container .party, #agreement-form-container .signature-area { page-break-inside: avoid; break-inside: avoid; }
            #agreement-form-container .form-container > * { max-width: 100%; overflow: hidden; }
            #agreement-form-container .article-title { color: #000 !important; border-bottom: 1px solid #000 !important; font-size: 15px !important; padding-bottom: 3px; margin-bottom: 8px; }
            #agreement-form-container .article p, #agreement-form-container .article ul { font-size: 14px !important; margin-bottom: 7px; color: #000 !important; text-align: justify; }
            #agreement-form-container .article ul { margin-left: 18px; }
            #agreement-form-container .form-input { color: #000 !important; font-size: 14px !important; font-weight: bold; border-bottom: none !important; }
            
            #agreement-form-container .qrcode-container {
                border: 1px solid #000 !important;
                background: white !important;
                box-shadow: none !important;
                width: 90px !important;
                height: 90px !important;
                margin: 12px auto !important;
                padding: 3px !important;
                page-break-inside: avoid;
                break-inside: avoid;
            }
            
            #agreement-form-container .qrcode-container canvas { width: 84px !important; height: 84px !important; }
            #agreement-form-container .signature-info, #agreement-form-container .signature-name { font-size: 14px !important; color: #000 !important; }
            #agreement-form-container .signature-info { margin-bottom: 10px; }
            #agreement-form-container .signature-name { margin-top: 12px; padding-top: 5px; min-width: 160px; border-top: 1px solid #000 !important; }
            #agreement-form-container .page-number { display: block; position: running(pageNumber); font-size: 11px; color: #666; }
            .page-break { page-break-before: always; break-before: page; }
            p, li { line-height: 1.4; }
            #agreement-form-container .signature-area { display: flex !important; justify-content: space-between !important; flex-direction: row !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        
        <div id="registration-container">
            <div class="header">
                <img src="https://raw.githubusercontent.com/anekamarket/my.id/refs/heads/main/LOGO%20UMKM%20SITUBONDO.png" alt="ANEKAMARKET Logo" class="logo-img">
                <h1>Formulir Pendaftaran Mitra</h1>
                <p>Langkah 1 dari 2: Isi Data Diri & Usaha Anda</p>
            </div>
            
            <div class="form-container">
                <form id="registrationForm">
                    <div class="form-section">
                        <h3>1. Data Pribadi</h3>
                        <div class="form-row">
                            <div class="form-group"><label for="nama" class="required">Nama (sesuai KTP)</label><input type="text" id="nama" name="nama" placeholder="Masukkan nama lengkap" required><div class="error-message" id="nama-error"></div></div>
                            <div class="form-group"><label for="nik" class="required">NIK (Nomor KTP)</label><input type="text" id="nik" name="nik" placeholder="Masukkan 16 digit NIK" required maxlength="16"><div class="error-message" id="nik-error"></div></div>
                        </div>
                        <div class="form-group"><label for="alamat" class="required">Alamat (sesuai KTP)</label><textarea id="alamat" name="alamat" rows="2" placeholder="Masukkan alamat lengkap" required></textarea><div class="error-message" id="alamat-error"></div></div>
                        <div class="form-row">
                            <div class="form-group"><label for="whatsapp" class="required">Nomor WhatsApp</label><input type="tel" id="whatsapp" name="whatsapp" placeholder="Contoh: 081234567890" required><div class="error-message" id="whatsapp-error"></div></div>
                            <div class="form-group"><label for="email">Email (Opsional)</label><input type="email" id="email" name="email" placeholder="contoh@gmail.com"><div class="error-message" id="email-error"></div></div>
                        </div>
                        <div class="form-group">
                            <label for="foto_ktp" class="required">Foto/Scan KTP</label>
                            <div class="file-input-wrapper">
                                <input type="file" id="foto_ktp" name="foto_ktp" accept="image/*" required>
                                <span class="file-input-label">Klik untuk memilih gambar...</span>
                                <span id="file-name"></span>
                            </div>
                            <div class="error-message" id="foto_ktp-error"></div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>2. Data Usaha</h3>
                        <div class="form-group"><label for="nama_usaha" class="required">Nama Usaha / Brand</label><input type="text" id="nama_usaha" name="nama_usaha" placeholder="Contoh: Cafe Bintang" required><div class="error-message" id="nama_usaha-error"></div></div>
                        <div class="form-group"><label for="alamat_usaha" class="required">Alamat Usaha</label><textarea id="alamat_usaha" name="alamat_usaha" rows="2" placeholder="Masukkan alamat lengkap usaha" required></textarea><div class="error-message" id="alamat_usaha-error"></div></div>
                        
                        <div class="form-group">
                            <label for="lokasi_maps" class="required">URL Titik Lokasi Google Maps</label>
                            <div class="location-warning" id="location-warning">
                                <strong>Penting:</strong> Untuk akurasi, dapatkan titik lokasi saat Anda berada di tempat usaha.
                            </div>
                            <input type="url" id="lokasi_maps" name="lokasi_maps" placeholder="Contoh: https://maps.app.goo.gl/..." required>
                            <div class="location-button-group">
                                <button type="button" class="btn btn-location" id="getLocationBtn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-geo-alt-fill" viewBox="0 0 16 16"><path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/></svg>
                                    Gunakan Lokasi Saat Ini
                                </button>
                                <button type="button" class="btn btn-secondary" id="registerLaterBtn">Daftarkan Lokasi Nanti</button>
                            </div>
                            <div class="status-message" id="location-status"></div>
                            <div class="error-message" id="lokasi_maps-error"></div>
                        </div>

                        <div class="form-group">
                            <label for="kategori_usaha" class="required">Kategori Usaha</label>
                            <select id="kategori_usaha" name="kategori_usaha" required>
                                <option value="">Pilih Kategori Usaha</option>
                                <option value="UMKM">UMKM</option><option value="Jasa Service">Jasa Service</option><option value="Kuliner">Kuliner</option><option value="Warung atau Resto">Warung atau Resto</option><option value="Cafe">Cafe</option><option value="Retail">Retail</option><option value="Pertanian">Pertanian</option><option value="Perikanan">Perikanan</option><option value="Kerajinan">Kerajinan</option><option value="Jasa Transportasi">Jasa Transportasi</option><option value="Wisata">Wisata</option><option value="Hotel">Hotel</option><option value="Lainnya">Lainnya</option>
                            </select>
                            <div class="error-message" id="kategori_usaha-error"></div>
                        </div>
                        <div class="form-group" id="lainnya_keterangan_group" style="display: none;"><label for="keterangan_lainnya" class="required">Keterangan Kategori Lainnya</label><textarea id="keterangan_lainnya" name="keterangan_lainnya" rows="2" placeholder="Jelaskan kategori usaha Anda"></textarea><div class="error-message" id="keterangan_lainnya-error"></div></div>
                    </div>
                    
                    <div class="form-section">
                        <h3>3. Konfirmasi Awal</h3>
                        <div class="form-row">
                            <div class="form-group"><label for="id_permohonan">ID Permohonan</label><input type="text" id="id_permohonan" name="id_permohonan" readonly></div>
                            <div class="form-group"><label for="tanggal_pendaftaran">Tanggal Pendaftaran</label><input type="text" id="tanggal_pendaftaran" name="tanggal_pendaftaran" readonly></div>
                        </div>
                        <label class="checkbox-group">
                            <input type="checkbox" id="agree" name="agree" required>
                            <span class="checkbox-custom"></span>
                            <span class="checkbox-label">Saya menyatakan data yang diisi adalah benar dan menyetujuinya</span>
                        </label>
                        <div class="error-message" id="agree-error"></div>
                    </div>
                    
                    <button type="button" class="btn btn-primary" id="nextBtn" disabled>
                        Lanjut ke Perjanjian (Langkah 2)
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-right-circle-fill" viewBox="0 0 16 16">
                          <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0zM4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5z"/>
                        </svg>
                    </button>
                </form>
            </div>
        </div>
        
        <div id="agreement-container" style="display: none;">
            <div id="agreement-form-container">
                <div class="security-pattern"></div>
                
                <div class="watermark">LENTERA KARYA SITUBONDO</div>
                
                <div class="form-container">
                    <div class="no-print">
                        <h1 style="color: #1a3d7c; text-align: center; margin-bottom: 10px; font-family: 'Playfair Display', serif; font-size: 22px;">Formulir Perjanjian Layanan LKS 2025</h1>
                        <p style="text-align: center; margin-bottom: 20px; color: #000; font-size: 14px;">Langkah 2 dari 2: Mohon periksa, lengkapi, dan setujui perjanjian layanan.</p>
                        
                        <div class="form-group">
                            <label for="nama_pemohon">Nama Pemohon (dari Langkah 1):</label>
                            <input type="text" id="nama_pemohon" name="nama_pemohon" class="uppercase" required readonly style="background-color: #f0f0f0;">
                            <div id="nama_pemohon_error" class="error-message agreement-error">Nama harus diisi</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="nik_perjanjian">NIK (dari Langkah 1):</label>
                            <input type="text" id="nik_perjanjian" name="nik_perjanjian" required maxlength="16" pattern="\d{16}" placeholder="Masukkan 16 digit NIK" readonly style="background-color: #f0f0f0;">
                            <div id="nik_perjanjian_error" class="error-message agreement-error">NIK harus 16 digit angka</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="alamat_perjanjian">Alamat Lengkap (dari Langkah 1):</label>
                            <input type="text" id="alamat_perjanjian" name="alamat_perjanjian" required readonly style="background-color: #f0f0f0;">
                            <div id="alamat_perjanjian_error" class="error-message agreement-error">Alamat harus diisi</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="nomor_telepon">Nomor Telepon (dari Langkah 1):</label>
                            <input type="tel" id="nomor_telepon" name="nomor_telepon" required pattern="08\d{8,11}" maxlength="13" placeholder="Contoh: 081234567890" readonly style="background-color: #f0f0f0;">
                            <div id="nomor_telepon_error" class="error-message agreement-error">Nomor harus diawali 08 dan 10-13 digit</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="tanggal_pendaftaran_perjanjian">Tanggal Pendaftaran:</label>
                            <input type="date" id="tanggal_pendaftaran_perjanjian" name="tanggal_pendaftaran_perjanjian" required readonly style="background-color: #f0f0f0;">
                            <div id="tanggal_pendaftaran_perjanjian_error" class="error-message agreement-error">Tanggal harus diisi</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="id_pendaftaran">No. ID Pendaftaran (Otomatis):</label>
                            <input type="text" id="id_pendaftaran" name="id_pendaftaran" readonly style="background-color: #f0f0f0; font-weight: bold;">
                        </div>
                        
                        <div class="form-group">
                            <label for="nama_umkm">Nama UMKM (dari Langkah 1):</label>
                            <input type="text" id="nama_umkm" name="nama_umkm" class="uppercase" required readonly style="background-color: #f0f0f0;">
                            <div id="nama_umkm_error" class="error-message agreement-error">Nama UMKM harus diisi</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="kategori_layanan" class="required">Kategori Layanan:</label>
                            <select id="kategori_layanan" name="kategori_layanan" required>
                                <option value="">-- Pilih Kategori --</option>
                                <option value="UMKM">UMKM</option>
                                <option value="Jasa Service">Jasa Service</option>
                                <option value="Kuliner">Kuliner</option>
                                <option value="Warung atau Resto">Warung atau Resto</option>
                                <option value="Cafe">Cafe</option>
                                <option value="Retail">Retail</option>
                                <option value="Pertanian">Pertanian</option>
                                <option value="Perikanan">Perikanan</option>
                                <option value="Kerajinan">Kerajinan</option>
                                <option value="Jasa Transportasi">Jasa Transportasi</option>
                                <option value="Wisata">Wisata</option>
                                <option value="Hotel">Hotel</option>
                                <option value="Lainnya">Lainnya</option>
                            </select>
                            <div id="kategori_layanan_error" class="error-message agreement-error">Kategori harus dipilih</div>
                        </div>
                        
                        <div class="loading" id="loading-indicator">
                            Membuat dokumen, harap tunggu...
                        </div>
                        
                        <div class="button-group">
                            <button type="button" onclick="validateAndGenerate()">Generate/Update Surat Perjanjian</button>
                            <button type="button" onclick="printDocument()" class="print">Cetak Dokumen</button>
                            <button type="button" onclick="downloadDocument()" class="download">Download PDF</button>
                            <button type="button" onclick="sendViaWhatsApp()" class="whatsapp">Kirim via WhatsApp</button>
                        </div>
                    </div>
                    
                    <div id="agreement-document">
                        </div>

                    <div class="step-navigation no-print">
                        <button type="button" class="btn btn-secondary" id="prevBtn" style="width: auto; font-size: 1rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-left-circle-fill" viewBox="0 0 16 16">
                              <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.5 7.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/>
                            </svg>
                            Kembali ke Data Diri
                        </button>

                        <button type="button" class="btn btn-primary" id="finalSubmitBtn">
                            Kirim Pendaftaran
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-send-fill" viewBox="0 0 16 16">
                              <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="success-container" style="display: none;">
            </div>

    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            // =========================================================================================
            // ::: KONFIGURASI WAJIB :::
            // GANTI SEMUA NILAI DI BAWAH INI DENGAN KUNCI API DARI AKUN ANDA MASING-MASING.
            // JIKA TIDAK DIGANTI, FITUR KIRIM DATA 100% GAGAL.
            // =========================================================================================

            // 1. KUNCI API IMGBB (Untuk upload gambar KTP & Perjanjian)
            //    -> Daftar di imgbb.com, lalu buka halaman API dan salin kuncinya.
            const apiKeyImgBB = '0e598ab24278f062969e6d0ec810d518'; // CONTOH: '0e598ab24278f062969e6d0ec810d518'

            // 2. KUNCI LAYANAN EMAILJS (Untuk mengirim notifikasi email)
            //    -> Daftar di emailjs.com, buat layanan (misal: Gmail), lalu salin:
            const emailjs_PublicKey = 'O0CF5tp-jRja9rZ4k'; // DARI: Account -> API Keys
            const emailjs_ServiceID = 'JSservice_qxkw1eg; // DARI: Email Services
            const emailjs_TemplateID = 'GANTI_DENGAN_TEMPLATE_ID_ANDA'; // DARI: Email Templates
            
            // 3. NOMOR WHATSAPP TUJUAN (Format internasional, awali dengan 62)
            const nomorWhatsAppTujuan = '6285647709114'; // Ganti dengan nomor Admin Anekamarket
            const nomorWhatsAppTujuanPerjanjian = '6287865614222'; // Ganti dengan nomor Admin LKS

            // =========================================================================================
            // AKHIR DARI KONFIGURASI WAJIB
            // =========================================================================================

            // --- Inisialisasi EmailJS ---
            (function() {
                if(emailjs_PublicKey !== 'GANTI_DENGAN_PUBLIC_KEY_ANDA') {
                    emailjs.init({ publicKey: emailjs_PublicKey });
                }
            })();

            // --- Variabel Global ---
            let finalWhatsAppMessage = '';

            // --- Elemen Form Langkah 1 (Pendaftaran) ---
            const registrationContainer = document.getElementById('registration-container');
            const formRegistrasi = document.getElementById('registrationForm');
            const kategoriSelect = document.getElementById('kategori_usaha');
            const lainnyaGroup = document.getElementById('lainnya_keterangan_group');
            const keteranganLainnya = document.getElementById('keterangan_lainnya');
            const ktpInput = document.getElementById('foto_ktp');
            const fileNameDisplay = document.getElementById('file-name');
            const mapsInput = document.getElementById('lokasi_maps');
            const registerLaterBtn = document.getElementById('registerLaterBtn');
            const getLocationBtn = document.getElementById('getLocationBtn');
            const locationStatus = document.getElementById('location-status');
            const agreeCheckbox = document.getElementById('agree');
            const nextBtn = document.getElementById('nextBtn');

            // --- Elemen Form Langkah 2 (Perjanjian) ---
            const agreementContainer = document.getElementById('agreement-container');
            const prevBtn = document.getElementById('prevBtn');
            const finalSubmitBtn = document.getElementById('finalSubmitBtn');
            const loadingIndicator = document.getElementById('loading-indicator');
            
            // Elemen input perjanjian
            const namaPemohonPerjanjian = document.getElementById('nama_pemohon');
            const nikPerjanjian = document.getElementById('nik_perjanjian');
            const alamatPerjanjian = document.getElementById('alamat_perjanjian');
            const nomorTeleponPerjanjian = document.getElementById('nomor_telepon');
            const tanggalPendaftaranPerjanjian = document.getElementById('tanggal_pendaftaran_perjanjian');
            const idPendaftaranPerjanjian = document.getElementById('id_pendaftaran');
            const namaUmkmPerjanjian = document.getElementById('nama_umkm');
            const kategoriLayananPerjanjian = document.getElementById('kategori_layanan');

            // --- Elemen Form Langkah 3 (Sukses) ---
            const successContainer = document.getElementById('success-container');
            
            // ==========================================================
            // --- LOGIKA LANGKAH 1: PENDAFTARAN ---
            // ==========================================================

            function generateIdPermohonan() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let result = 'AM-';
                for (let i = 0; i < 6; i++) {
                    result += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return result;
            }
            
            function setTanggalPendaftaran() {
                const now = new Date();
                const options = { 
                    day: '2-digit', month: 'long', year: 'numeric',
                    hour: '2-digit', minute: '2-digit'
                };
                return now.toLocaleString('id-ID', options).replace(/\./g, ':');
            }
            
            document.getElementById('id_permohonan').value = generateIdPermohonan();
            document.getElementById('tanggal_pendaftaran').value = setTanggalPendaftaran();
            
            kategoriSelect.addEventListener('change', function() {
                lainnyaGroup.style.display = this.value === 'Lainnya' ? 'block' : 'none';
                if (this.value === 'Lainnya') {
                    keteranganLainnya.setAttribute('required', 'required');
                } else {
                    keteranganLainnya.removeAttribute('required');
                    keteranganLainnya.value = '';
                    hideError(keteranganLainnya);
                }
                validateFormPendaftaran();
            });
            
            ktpInput.addEventListener('change', function() {
                fileNameDisplay.textContent = this.files.length > 0 ? this.files[0].name : '';
                validateFormPendaftaran();
            });

            registerLaterBtn.addEventListener('click', function() {
                mapsInput.value = 'Akan diisi nanti';
                mapsInput.removeAttribute('required');
                document.getElementById('location-warning').style.display = 'none';
                hideError(mapsInput);
                validateFormPendaftaran();
            });

            getLocationBtn.addEventListener('click', function() {
                if (!navigator.geolocation) {
                    locationStatus.textContent = 'Geolocation tidak didukung oleh browser Anda.';
                    locationStatus.style.display = 'block';
                    locationStatus.style.color = 'var(--error-color)';
                    return;
                }

                locationStatus.textContent = 'Mendeteksi lokasi Anda...';
                locationStatus.style.display = 'block';
                locationStatus.style.color = 'var(--dark-color)';
                mapsInput.setAttribute('required', 'required');
                hideError(mapsInput);

                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        const mapsUrl = `https://www.google.com/maps?q=${lat},${lon}`;
                        
                        mapsInput.value = mapsUrl;
                        locationStatus.textContent = 'Lokasi berhasil dideteksi!';
                        locationStatus.style.color = 'var(--success-color)';
                        validateFormPendaftaran();
                    },
                    function(error) {
                        let errorMessage;
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = "Akses lokasi ditolak. Izinkan akses di pengaturan browser.";
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = "Informasi lokasi tidak tersedia.";
                                break;
                            case error.TIMEOUT:
                                errorMessage = "Waktu permintaan lokasi habis.";
                                break;
                            default:
                                errorMessage = "Terjadi kesalahan saat mengambil lokasi.";
                                break;
                        }
                        locationStatus.textContent = errorMessage;
                        locationStatus.style.display = 'block';
                        locationStatus.style.color = 'var(--error-color)';
                        validateFormPendaftaran();
                    }
                );
            });
            
            formRegistrasi.addEventListener('input', validateFormPendaftaran);
            
            function validateFormPendaftaran() {
                let allValid = true;
                const requiredFields = formRegistrasi.querySelectorAll('[required]');
                
                requiredFields.forEach(field => {
                    let isValid = true;
                    let errorMessage = '';

                    if (field.type === 'checkbox') {
                        if (!field.checked) isValid = false;
                        errorMessage = 'Anda harus menyetujui pernyataan ini.';
                    } else if (field.type === 'file') {
                        if (field.files.length === 0) isValid = false;
                        errorMessage = 'Anda harus mengunggah foto KTP.';
                    } else if (field.type === 'url') {
                        if (field.value.trim() === '') isValid = false;
                        else if (field.value !== 'Akan diisi nanti' && !/^(https?:\/\/)?(www\.)?(google\.com\/maps|maps\.app\.goo\.gl)\S+$/.test(field.value)) {
                            isValid = false;
                            errorMessage = 'Format URL Google Maps tidak valid.';
                        }
                    } else if (field.type === 'select-one') {
                        if (field.value === '') isValid = false;
                        errorMessage = 'Anda harus memilih salah satu kategori.';
                    } else {
                        if (field.value.trim() === '') isValid = false;
                        errorMessage = 'Field ini wajib diisi.';
                    }
                    
                    if (field.id === 'nik' && field.value.trim() !== '' && !/^\d{16}$/.test(field.value)) {
                        isValid = false;
                        errorMessage = 'NIK harus terdiri dari 16 digit angka.';
                    } else if (field.id === 'whatsapp' && field.value.trim() !== '' && !/^08\d{8,11}$/.test(field.value)) {
                       isValid = false;
                       errorMessage = 'Format No. WhatsApp salah. Contoh: 081234567890.';
                    }

                    if(isValid) hideError(field);
                    else {
                        showError(field, errorMessage);
                        allValid = false;
                    }
                });
                
                const emailField = document.getElementById('email');
                if (emailField.value !== '' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailField.value)) {
                    showError(emailField, 'Format email tidak valid.');
                    allValid = false;
                } else {
                    hideError(emailField);
                }
                
                nextBtn.disabled = !allValid;
                return allValid;
            }
            
            function showError(field, message) {
                const errorElement = document.getElementById(`${field.id}-error`);
                if(errorElement) {
                    field.style.borderColor = 'var(--error-color)';
                    if (field.type === 'file') field.parentElement.style.borderColor = 'var(--error-color)';
                    errorElement.textContent = message;
                    errorElement.style.display = 'block';
                }
            }
            
            function hideError(field) {
                const errorElement = document.getElementById(`${field.id}-error`);
                if (errorElement) {
                    field.style.borderColor = 'var(--border-color)';
                     if (field.type === 'file') field.parentElement.style.borderColor = 'var(--border-color)';
                    errorElement.style.display = 'none';
                }
            }

            // ==========================================================
            // --- LOGIKA LANGKAH 2: PERJANJIAN ---
            // ==========================================================
            
            const today = new Date();
            tanggalPendaftaranPerjanjian.value = today.toISOString().substr(0, 10);

            const inputsPerjanjian = agreementContainer.querySelectorAll('input[required], select[required]');
            inputsPerjanjian.forEach(input => {
                input.addEventListener('blur', () => validateFieldPerjanjian(input));
            });

            function generateRandomID() {
                const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                let result = 'LKS/JK-';
                for (let i = 0; i < 8; i++) {
                    result += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return result;
            }

            function autoGenerateID() {
                if (namaPemohonPerjanjian.value && nikPerjanjian.value && !idPendaftaranPerjanjian.value) { 
                    idPendaftaranPerjanjian.value = generateRandomID();
                }
            }
            
            function validateFieldPerjanjian(field) {
                const errorElement = document.getElementById(field.id + '_error');
                let isValid = true;
                let message = '';
                
                if (!field.value) {
                    isValid = false;
                    message = 'Field ini harus diisi';
                } else if (field.id === 'nik_perjanjian' && !/^\d{16}$/.test(field.value)) {
                    isValid = false;
                    message = 'NIK harus 16 digit angka';
                } else if (field.id === 'nomor_telepon' && !/^08\d{8,11}$/.test(field.value)) {
                    isValid = false;
                    message = 'Nomor harus diawali 08 dan 10-13 digit';
                }
                
                if (isValid) {
                    hideErrorPerjanjian(field, errorElement);
                } else {
                    showErrorPerjanjian(field, errorElement, message);
                }
                return isValid;
            }
            
            function validateFormPerjanjian() {
                return [...inputsPerjanjian].every(validateFieldPerjanjian);
            }

            function showErrorPerjanjian(field, errorElement, message) {
                field.classList.add('input-error');
                if (errorElement) {
                    errorElement.textContent = message;
                    errorElement.style.display = 'block';
                }
            }

            function hideErrorPerjanjian(field, errorElement) {
                field.classList.remove('input-error');
                if (errorElement) {
                    errorElement.style.display = 'none';
                }
            }
            
            /**
             * PERBAIKAN: Fungsi ini sekarang membuat seluruh HTML surat perjanjian secara dinamis.
             * Ini mencegah struktur pasal terlihat di sumber HTML awal.
             */
            function generateAgreementHTML(data) {
                // Dengan memindahkan HTML ke sini, "View Page Source" tidak akan menampilkannya.
                // Konten ini hanya ada di memori browser setelah fungsi ini dijalankan.
                return `
                    <div class="header">
                        <div class="logo-container">
                            <img src="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" alt="Logo Lentera Karya Situbondo" class="logo-img">
                        </div>
                        <div class="company-name">LENTERA KARYA SITUBONDO</div>
                        <div class="company-tagline">Inovasi dan Teknologi untuk UMKM</div>
                        <div class="company-address">Desa Wringin Anom, Kecamatan Panarukan, Kabupaten Situbondo, Jawa Timur</div>
                        <div class="contact-info">
                            <span>Email: admin@anekamarket.my.id</span> | 
                            <span>Telp: +62 878-6561-4222</span>
                        </div>
                        <div class="contact-info">
                            <span>Website: www.anekamarket.my.id</span>
                        </div>
                        <div class="header-line"></div>
                    </div>
                    <div class="document-title">SURAT PERJANJIAN PENYEDIAAN DAN PENGGUNAAN LAYANAN APLIKASI</div>
                    <div class="document-number">Nomor: <span>${data.nomorSurat}</span></div>
                    <div class="parties">
                        <p style="font-size: 14px;">Pada hari ini, ${data.hariTanggal}. Bertempat di Situbondo, kami yang bertanda tangan di bawah ini:</p>
                        <div class="party">
                            <div class="party-title">PIHAK PERTAMA (Penyedia Platform):</div>
                            <p>Nama Lengkap: <strong>MUHAMMAD SALAM</strong></p>
                            <p>Jabatan: <strong>Founder Lentera Karya Situbondo</strong></p>
                            <p>Alamat: Desa Wringin Anom, Kecamatan Panarukan, Kabupaten Situbondo, Jawa Timur</p>
                            <p>(Selanjutnya disebut "ANEKAMARKET")</p>
                        </div>
                        <div class="party">
                            <div class="party-title">PIHAK KEDUA (Mitra UMKM):</div>
                            <p>Nama Pemohon : <span class="form-input">${data.namaPemohon}</span></p>
                            <p>NIK : <span class="form-input">${data.nik}</span></p>
                            <p>Alamat : <span class="form-input">${data.alamat}</span></p>
                            <p>Nomor Telepon : <span class="form-input">${data.nomorTelepon}</span></p>
                            <p>No. ID Pendaftaran : <span class="form-input">${data.idPendaftaran}</span></p>
                            <p>Nama UMKM : <span class="form-input">${data.namaUmkm}</span></p>
                            <p>Kategori Layanan : <span class="form-input">${data.kategoriLayanan}</span></p>
                            <p>(Selanjutnya disebut "MITRA")</p>
                        </div>
                    </div>
                    <div class="article"><div class="article-title">PASAL 1 - MAKSUD DAN TUJUAN</div><p>Perjanjian ini dibuat untuk mengatur hak dan kewajiban PARA PIHAK dalam rangka penyediaan dan penggunaan platform digital ANEKAMARKET sebagai sarana promosi dan publikasi bagi MITRA.</p></div>
                    <div class="article"><div class="article-title">PASAL 2 - RUANG LINGKUP LAYANAN</div><p>1. ANEKAMARKET menyediakan platform digital yang berfungsi untuk mempublikasikan dan mempromosikan informasi produk dan/atau jasa milik MITRA kepada masyarakat umum.</p><p>2. MITRA berhak untuk mengelola halaman usahanya dan menampilkan informasi produk/jasa pada platform yang telah disediakan oleh ANEKAMARKET.</p></div>
                    <div class="article"><div class="article-title">PASAL 3 - HAK DAN KEWAJIBAN ANEKAMARKET (PIHAK PERTAMA)</div><p>1. Berusaha secara wajar untuk menjaga platform ANEKAMARKET agar dapat diakses oleh publik.</p><p>2. Berhak meninjau, menolak, atau menurunkan konten (teks/gambar) yang diunggah oleh MITRA jika dinilai melanggar hukum, norma kesusilaan, atau kebijakan platform (contoh: penipuan, pornografi, barang ilegal).</p><p>3. ANEKAMARKET hanya bertindak sebagai penyedia platform promosi dan TIDAK BERTANGGUNG JAWAB atas transaksi, pembayaran, pengiriman, kualitas produk, atau keluhan pelanggan yang terjadi antara MITRA dan pelanggannya.</p></div>
                    <div class="article"><div class="article-title">PASAL 4 - HAK DAN KEWAJIBAN MITRA (PIHAK KEDUA)</div><p>1. Bertanggung jawab penuh atas kebenaran, keakuratan, kualitas, dan legalitas dari seluruh informasi, produk, atau jasa yang dipromosikan melalui platform ANEKAMARKET.</p><p>2. Wajib memberikan informasi yang jujur, tidak menyesatkan, dan pelayanan yang baik kepada pelanggan.</p><p>3. Bertanggung jawab penuh untuk menangani segala proses transaksi, keluhan, atau perselisihan yang timbul dari produk/jasa yang ditawarkannya.</p><p>4. Wajib menjaga nama baik platform ANEKAMARKET dan tidak menyalahgunakan platform untuk tujuan yang melanggar hukum.</p></div>
                    <div class="article"><div class="article-title">PASAL 5 - PENUTUP</div><p>Perjanjian ini berlaku selama MITRA masih terdaftar dan aktif menggunakan layanan platform ANEKAMARKET. Segala perselisihan yang mungkin timbul akan diselesaikan terlebih dahulu secara musyawarah mufakat. Demikian perjanjian ini dibuat dan disetujui secara elektronik oleh PARA PIHAK sebagai bukti kerja sama yang sah.</p></div>
                    <div class="signature-area">
                        <div class="signature-box">
                            <div class="signature-info"><p>Situbondo, ${data.fullDate}</p></div>
                            <p>PIHAK KEDUA<br>Pemohon/Pengguna Layanan</p>
                            <div id="qrcode_pihak_kedua" class="qrcode-container"></div>
                            <div class="signature-name"><span>${data.namaPemohon}</span></div>
                        </div>
                        <div class="signature-box">
                            <div class="signature-info"><p>Situbondo, 07 Juli 2025</p></div>
                            <p>PIHAK PERTAMA<br>Founder Lentera Karya Situbondo</p>
                            <div id="qrcode_pihak_pertama" class="qrcode-container"></div>
                            <div class="signature-name">MUHAMMAD SALAM</div>
                        </div>
                    </div>
                    <div class="page-number"></div>
                `;
            }

            async function generateAgreement() {
                const agreementData = {
                    namaPemohon: namaPemohonPerjanjian.value,
                    nik: nikPerjanjian.value,
                    alamat: alamatPerjanjian.value,
                    nomorTelepon: nomorTeleponPerjanjian.value,
                    idPendaftaran: idPendaftaranPerjanjian.value,
                    namaUmkm: namaUmkmPerjanjian.value,
                    kategoriLayanan: kategoriLayananPerjanjian.value,
                    fullDate: formatFullDate(tanggalPendaftaranPerjanjian.value),
                    hariTanggal: getHariTanggal(tanggalPendaftaranPerjanjian.value),
                    nomorSurat: generateNomorSurat(idPendaftaranPerjanjian.value)
                };

                document.getElementById('agreement-document').innerHTML = generateAgreementHTML(agreementData);
                
                try {
                    const qrDataPihak2 = `PEMOHON:${agreementData.namaPemohon}|NIK:${agreementData.nik}|ID:${agreementData.idPendaftaran}`;
                    const qrDataPihak1 = `PERUSAHAAN:LENTERA KARYA|PENANDATANGAN:MUHAMMAD SALAM|JABATAN:FOUNDER`;
                    await Promise.all([
                        generateQRCode('qrcode_pihak_kedua', qrDataPihak2),
                        generateQRCode('qrcode_pihak_pertama', qrDataPihak1)
                    ]);
                } catch (error) {
                    console.error("Gagal membuat QR Code:", error);
                    throw new Error("Gagal generate QR Code untuk perjanjian.");
                }
            }
            
            async function validateAndGenerate() {
                if (!validateFormPerjanjian()) {
                    throw new Error('Formulir perjanjian tidak valid. Silakan periksa kembali data Anda.');
                }
                await generateAgreement();
            }

            function generateQRCode(elementId, data) {
                return new Promise((resolve, reject) => {
                    const element = document.getElementById(elementId);
                    if (!element) return reject(new Error(`Elemen QR dengan id ${elementId} tidak ditemukan`));
                    
                    element.innerHTML = '';
                    const canvas = document.createElement('canvas');
                    QRCode.toCanvas(canvas, data, {
                        width: 90, margin: 1, color: { dark: "#000", light: "#fff" }
                    }, (error) => {
                        if (error) reject(error);
                        else {
                            element.appendChild(canvas);
                            resolve();
                        }
                    });
                });
            }
            
            function formatFullDate(dateString) {
                return new Date(dateString + 'T00:00:00').toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
            }
            
            function getHariTanggal(dateString) {
                const date = new Date(dateString + 'T00:00:00');
                const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
                return date.toLocaleDateString('id-ID', options);
            }
            
            function generateNomorSurat(idPendaftaran) {
                if (!idPendaftaran) return '......../SP3LA-LKS/--/----';
                const date = new Date(tanggalPendaftaranPerjanjian.value + 'T00:00:00');
                const uniqueId = idPendaftaran.split('-')[1] || '000000';
                return `${uniqueId}/SP3LA-LKS/${date.getMonth() + 1}/${date.getFullYear()}`;
            }

            namaPemohonPerjanjian.addEventListener('input', function() { this.value = this.value.toUpperCase(); autoGenerateID(); });
            nikPerjanjian.addEventListener('input', autoGenerateID);
            namaUmkmPerjanjian.addEventListener('input', function() { this.value = this.value.toUpperCase(); });
            
            // ==========================================================
            // --- LOGIKA NAVIGASI & SUBMIT GABUNGAN ---
            // ==========================================================

            nextBtn.addEventListener('click', async function() {
                if (validateFormPendaftaran()) {
                    registrationContainer.style.display = 'none';
                    agreementContainer.style.display = 'block';
                    window.scrollTo(0, 0);

                    namaPemohonPerjanjian.value = document.getElementById('nama').value.toUpperCase();
                    nikPerjanjian.value = document.getElementById('nik').value;
                    alamatPerjanjian.value = document.getElementById('alamat').value;
                    nomorTeleponPerjanjian.value = document.getElementById('whatsapp').value;
                    namaUmkmPerjanjian.value = document.getElementById('nama_usaha').value.toUpperCase();
                    kategoriLayananPerjanjian.value = document.getElementById('kategori_usaha').value;
                    
                    autoGenerateID();
                    try {
                        await validateAndGenerate();
                    } catch (error) {
                        console.error("Gagal generate perjanjian saat lanjut:", error.message);
                    }
                } else {
                    alert('Data di Langkah 1 belum lengkap atau tidak valid. Silakan periksa kembali.');
                }
            });

            prevBtn.addEventListener('click', function() {
                agreementContainer.style.display = 'none';
                registrationContainer.style.display = 'block';
                window.scrollTo(0, 0);
            });

            finalSubmitBtn.addEventListener('click', async function(e) {
                e.preventDefault();

                // PERBAIKAN KRUSIAL: Cek konfigurasi sebelum melakukan apapun
                if (apiKeyImgBB.includes('GANTI_DENGAN') || emailjs_ServiceID.includes('GANTI_DENGAN')) {
                    alert('KESALAHAN KONFIGURASI:\n\nKunci API untuk ImgBB atau EmailJS belum diatur di dalam kode. \n\nFormulir tidak dapat dikirim. Hubungi developer untuk memperbaiki ini.');
                    return;
                }
                
                try {
                    if (!validateFormPendaftaran()) {
                        alert('Data di Langkah 1 (Data Diri & Usaha) tidak valid. Silakan klik "Kembali" untuk memperbaikinya.');
                        return;
                    }
                    
                    await validateAndGenerate();
                    
                    finalSubmitBtn.disabled = true;
                    finalSubmitBtn.innerHTML = 'Mengunggah KTP...';
                
                    const ktpFile = document.getElementById('foto_ktp').files[0];
                    const ktpUrl = await uploadFileToImgBB(ktpFile); 
                    
                    finalSubmitBtn.innerHTML = 'Mengunggah Perjanjian...';

                    const agreementElement = document.getElementById('agreement-document');
                    const canvas = await html2pdf().from(agreementElement).output('canvas');
                    
                    if (!canvas) throw new Error("Gagal membuat canvas dari dokumen perjanjian.");
                    
                    const agreementUrl = await uploadBase64ToImgBB(canvas.toDataURL('image/jpeg', 0.9));

                    finalSubmitBtn.innerHTML = 'Mengirim Data...';
                    const params = getCombinedTemplateParams(ktpUrl, agreementUrl);
                    
                    await sendEmail(params);
                    
                    const message = `*PENDAFTARAN MITRA ANEKAMARKET BERHASIL*%0A%0A*Data Pribadi:*%0A• Nama: ${params.nama}%0A• NIK: ${params.nik}%0A• WhatsApp: ${params.whatsapp}%0A• Link Foto KTP: ${ktpUrl}%0A%0A*Data Usaha:*%0A• Nama Usaha: ${params.nama_usaha}%0A• Alamat Usaha: ${params.alamat_usaha}%0A• Kategori Usaha: ${params.kategori_usaha}%0A%0A*Data Perjanjian:*%0A• No. ID LKS: ${params.id_pendaftaran_lks}%0A• Link Gambar Perjanjian: ${agreementUrl}%0A%0A*Data Sistem:*%0A• ID Permohonan: ${params.id_permohonan}%0A• Tanggal Pendaftaran: ${params.tanggal_pendaftaran}%0A%0A_Data ini telah terkirim dan saya setujui._`;
                    finalWhatsAppMessage = message;
                    
                    showSuccessScreen();

                } catch (error) {
                    console.error('Proses submit gagal:', error);
                    alert('PROSES GAGAL: ' + error.message + '\n\nMohon periksa koneksi Anda dan coba lagi. Jika masalah berlanjut, hubungi admin.');
                    
                    finalSubmitBtn.disabled = false;
                    finalSubmitBtn.innerHTML = `Kirim Pendaftaran <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-send-fill" viewBox="0 0 16 16"><path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"/></svg>`;
                }
            });

            // ==========================================================
            // --- FUNGSI HELPER GABUNGAN (Upload, Email, dll) ---
            // ==========================================================

            async function uploadFileToImgBB(file) {
                const formData = new FormData();
                formData.append('image', file);
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKeyImgBB}`, { method: 'POST', body: formData });
                const result = await response.json();
                if (result.success) return result.data.url;
                throw new Error(result.error.message || 'Gagal mengunggah Foto KTP.');
            }
            
            async function uploadBase64ToImgBB(base64string) {
                const formData = new FormData();
                formData.append('image', base64string.split(',')[1]); // Ambil hanya data base64
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKeyImgBB}`, { method: 'POST', body: formData });
                const result = await response.json();
                if (result.success) return result.data.url;
                throw new Error(result.error.message || 'Gagal mengunggah Gambar Perjanjian.');
            }
            
            function getCombinedTemplateParams(ktpUrl, agreementUrl) {
                let kategoriUsaha = kategoriSelect.value;
                if (kategoriUsaha === 'Lainnya') {
                    kategoriUsaha = `Lainnya (${keteranganLainnya.value})`;
                }
                return {
                    nama: document.getElementById('nama').value,
                    nik: document.getElementById('nik').value,
                    alamat: document.getElementById('alamat').value,
                    whatsapp: document.getElementById('whatsapp').value,
                    email: document.getElementById('email').value || 'Tidak diisi',
                    nama_usaha: document.getElementById('nama_usaha').value,
                    alamat_usaha: document.getElementById('alamat_usaha').value,
                    lokasi_maps: document.getElementById('lokasi_maps').value,
                    kategori_usaha: kategoriUsaha,
                    id_permohonan: document.getElementById('id_permohonan').value,
                    tanggal_pendaftaran: document.getElementById('tanggal_pendaftaran').value,
                    foto_ktp_url: ktpUrl,
                    id_pendaftaran_lks: idPendaftaranPerjanjian.value,
                    kategori_layanan_lks: kategoriLayananPerjanjian.value,
                    foto_perjanjian_url: agreementUrl
                };
            }

            async function sendEmail(templateParams) {
                try {
                    await emailjs.send(emailjs_ServiceID, emailjs_TemplateID, templateParams);
                    console.log('Email notifikasi berhasil terkirim!');
                } catch (err) {
                    console.error('Gagal mengirim email notifikasi. Error: ', JSON.stringify(err));
                    // Tidak menghentikan proses, hanya memberitahu di console
                    // Pendaftaran tetap berhasil, hanya notifikasi email ke admin yang gagal
                }
            }
            
            function showSuccessScreen() {
                registrationContainer.style.display = 'none';
                agreementContainer.style.display = 'none';
                successContainer.style.display = 'block';
                window.scrollTo(0, 0);

                successContainer.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="var(--success-color)" class="bi bi-check-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/></svg>
                    <h2 style="font-family: 'Poppins', sans-serif; margin-top: 20px;">Pendaftaran Berhasil!</h2>
                    <p style="color: var(--gray-color); margin: 15px 0 30px; line-height: 1.7;">
                        Terima kasih, data Anda telah kami terima.
                        <br><br>
                        <strong style="color: var(--error-color); font-size: 1.1rem;">LANGKAH TERAKHIR (WAJIB):</strong>
                        <br>
                        Klik tombol di bawah untuk mengirim konfirmasi pendaftaran kepada kami via WhatsApp.
                    </p>
                    <button type="button" class="btn btn-primary" id="sendWaButton" style="background: #25D366; box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-whatsapp" viewBox="0 0 16 16"><path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.626-2.957 6.584-6.591 6.584zM10.118 8.584c-.197-.1-.8-.396-1.02-.459-.22-.063-.38-.099-.54.099-.16.198-.5.63-.61.751-.12.122-.23.138-.43.038-.2-.099-.84-.31-1.59-1.02-.58-.55-1.01-1.23-1.13-1.43-.12-.2-.02-.3.07-.401.08-.09.19-.23.29-.33.1-.1.13-.17.2-.28.07-.1.03-.18-.02-.28-.05-.1-.54-1.28- .73-1.75-.19-.47-.38-.4-.54-.4-.16-.007-.34-.007-.5-.007-.16 0-.43.063-.66.33-.22.27-.85.83-.85 2.02 0 1.18.87 2.34 1 2.49.12.15 1.7 2.58 4.13 3.63.58.25 1.03.4 1.38.52.36.12.68.1.92.06.27-.05.8-.33.91-.65.12-.32.12-.58.08-.65-.05-.07-.17-.12-.37-.22z"/></svg>
                        Kirim Konfirmasi (WAJIB)
                    </button>
                `;
                document.getElementById('sendWaButton').addEventListener('click', sendFinalWhatsApp);
            }
            
            function sendFinalWhatsApp() {
                if (finalWhatsAppMessage) {
                    const whatsappURL = `https://wa.me/${nomorWhatsAppTujuan}?text=${finalWhatsAppMessage}`;
                    window.open(whatsappURL, '_blank');
                }
                setTimeout(() => {
                    window.location.href = 'https://www.anekamarket.my.id';
                }, 1000);
            }
        });
    </script>
</body>
</html>
